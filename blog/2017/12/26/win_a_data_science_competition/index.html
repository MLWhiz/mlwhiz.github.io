<!doctype html><html lang=en-us><head><meta charset=utf-8><title>MLWhiz: Helping You Learn Data Science!</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="Recently Kaggle master Kazanova along with some of his friends released a coursera course. The Course involved a final project which itself was a time series prediction problem. Here I will describe how I got a top 10 position as of writing this article."><meta name=author content="Rahul Agarwal"><meta name=generator content="Hugo 0.74.3"><link rel=stylesheet href=https://mlwhiz.com/plugins/compressjscss/main.css><meta property="og:title" content="Using XGBoost for time series prediction tasks"><meta property="og:description" content="Recently Kaggle master Kazanova along with some of his friends released a coursera course. The Course involved a final project which itself was a time series prediction problem. Here I will describe how I got a top 10 position as of writing this article."><meta property="og:type" content="article"><meta property="og:url" content="https://mlwhiz.com/blog/2017/12/26/win_a_data_science_competition/"><meta property="og:image" content="https://mlwhiz.com/images/lboard.png"><meta property="og:image:secure_url" content="https://mlwhiz.com/images/lboard.png"><meta property="article:published_time" content="2017-12-26T00:00:00+00:00"><meta property="article:modified_time" content="2020-09-26T16:23:35+05:30"><meta property="article:tag" content="Data Science"><meta property="article:tag" content="Awesome Guides"><meta name=twitter:card content="summary"><meta name=twitter:image content="https://mlwhiz.com/images/lboard.png"><meta name=twitter:title content="Using XGBoost for time series prediction tasks"><meta name=twitter:description content="Recently Kaggle master Kazanova along with some of his friends released a coursera course. The Course involved a final project which itself was a time series prediction problem. Here I will describe how I got a top 10 position as of writing this article."><meta name=twitter:site content="@mlwhiz"><meta name=twitter:creator content="@mlwhiz"><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href=https://mlwhiz.com/scss/style.min.css media=screen><link rel=stylesheet href=/css/style.css><link rel=stylesheet type=text/css href=/css/font/flaticon.css><link rel="shortcut icon" href=https://mlwhiz.com/images/favicon-200x200.png type=image/x-icon><link rel=icon href=https://mlwhiz.com/images/favicon.png type=image/x-icon><link rel=canonical href=https://mlwhiz.com/blog/2017/12/26/win_a_data_science_competition/><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://www.mlwhiz.com/#website","url":"https://www.mlwhiz.com/","name":"MLWhiz","description":"Want to Learn Computer Vision and NLP? - MLWhiz","potentialAction":{"@type":"SearchAction","target":"https://www.mlwhiz.com/search?s={search_term_string}","query-input":"required name=search_term_string"}},{"@type":"ImageObject","@id":"https://mlwhiz.com/blog/2017/12/26/win_a_data_science_competition/#primaryimage","url":"https://mlwhiz.com/images/lboard.png","width":700,"height":450},{"@type":"WebPage","@id":"https://mlwhiz.com/blog/2017/12/26/win_a_data_science_competition/#webpage","url":"https://mlwhiz.com/blog/2017/12/26/win_a_data_science_competition/","inLanguage":"en-US","name":"Using XGBoost for time series prediction tasks - MLWhiz","isPartOf":{"@id":"https://www.mlwhiz.com/#website"},"primaryImageOfPage":{"@id":"https://mlwhiz.com/blog/2017/12/26/win_a_data_science_competition/#primaryimage"},"datePublished":"2017-12-26T00:00:00.00Z","dateModified":"2020-09-26T16:23:35.00Z","author":{"@id":"https://mlwhiz.com/about/#/schema/person/76376876bchxkzbchjsdjcca"},"description":"Recently Kaggle master Kazanova along with some of his friends released a coursera course. The Course involved a final project which itself was a time series prediction problem. Here I will describe how I got a top 10 position as of writing this article."},{"@type":["Person"],"@id":"https://mlwhiz.com/about/#/schema/person/76376876bchxkzbchjsdjcca","name":"Rahul Agarwal","image":{"@type":"ImageObject","@id":"https://www.mlwhiz.com/#authorlogo","url":"https://mlwhiz.com/images/author.jpg","caption":"Rahul Agarwal"},"description":"Hi there, I\u2019m Rahul Agarwal. I\u2019m a data scientist consultant and big data engineer based in Bangalore. I see a lot of times  students and even professionals wasting their time and struggling to get started with Computer Vision, Deep Learning, and NLP. I Started this Site with a purpose to augment my own understanding about new things while helping others learn about them in the best possible way.","sameAs":["https://www.linkedin.com/in/rahulagwl/","https://medium.com/@rahul_agarwal","https://twitter.com/MLWhiz","https://www.facebook.com/mlwhizblog","https://github.com/MLWhiz","https://www.instagram.com/itsmlwhiz"]}]}</script><script async data-uid=a0ebaf958d src=https://mlwhiz.ck.page/a0ebaf958d/index.js></script><script type=text/javascript async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$']],processEscapes:true,processEnvironments:true,skipTags:['script','noscript','style','textarea','pre'],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}});MathJax.Hub.Queue(function(){var all=MathJax.Hub.getAllJax(),i;for(i=0;i<all.length;i+=1){all[i].SourceElement().parentNode.className+=' has-jax';}});MathJax.Hub.Config({TeX:{equationNumbers:{autoNumber:"AMS"}}});</script><link href=//apps.shareaholic.com/assets/pub/shareaholic.js as=script><script type=text/javascript data-cfasync=false async src=//apps.shareaholic.com/assets/pub/shareaholic.js data-shr-siteid=fd1ffa7fd7152e4e20568fbe49a489d0></script></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NMQD44T" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><div class=preloader></div><header class=navigation><div class=container><nav class="navbar navbar-expand-lg navbar-white bg-transparent border-bottom pl-0"><a class="navbar-brand mobile-view" href=https://mlwhiz.com/><img class=img-fluid src=https://mlwhiz.com/images/logo.png alt="MLWhiz: Helping You Learn Data Science!"></a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class="ti-menu h3"></i></button><div class="collapse navbar-collapse text-center" id=navigation><div class=desktop-view><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=https://www.linkedin.com/in/rahulagwl/><i class=ti-linkedin></i></a></li><li class=nav-item><a class=nav-link href=https://medium.com/@rahul_agarwal><i class=ti-book></i></a></li><li class=nav-item><a class=nav-link href=https://twitter.com/MLWhiz><i class=ti-twitter-alt></i></a></li><li class=nav-item><a class=nav-link href=https://www.facebook.com/mlwhizblog><i class=ti-facebook></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/MLWhiz><i class=ti-github></i></a></li></ul></div><a class="navbar-brand mx-auto desktop-view" href=https://mlwhiz.com/><img class=img-fluid-custom src=https://mlwhiz.com/images/logo.png alt="MLWhiz: Helping You Learn Data Science!"></a><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://mlwhiz.com/about>About</a></li><li class=nav-item><a class=nav-link href=https://mlwhiz.com/blog>Blog</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Topics</a><div class=dropdown-menu><a class=dropdown-item href=https://mlwhiz.com/categories/natural-language-processing>NLP</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/computer-vision>Computer Vision</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/deep-learning>Deep Learning</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/data-science>DS/ML</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/big-data>Big Data</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/awesome-guides>My Best Content</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/learning-resources>Learning Resources</a></div></li></ul><div class="search pl-lg-4"><button id=searchOpen class=search-btn><i class=ti-search></i></button><div class=search-wrapper><form action=https://mlwhiz.com//search class=h-100><input class="search-box px-4" id=search-query name=s type=search placeholder="Type & Hit Enter..."></form><button id=searchClose class=search-close><i class="ti-close text-dark"></i></button></div></div></div></nav></div></header><section class=section-sm><div class=container><div class=row><div class="col-lg-8 mb-5 mb-lg-0"><a href=/categories/data-science class=categoryStyle>Data Science</a>
<a href=/categories/awesome-guides class=categoryStyle>Awesome Guides</a><h1>Using XGBoost for time series prediction tasks</h1><div class="mb-3 post-meta"><span>By Rahul Agarwal</span><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg>
<span>26 December 2017</span></div><img src=https://mlwhiz.com/images/lboard.png class="img-fluid w-100 mb-4" alt="Using XGBoost for time series prediction tasks"><div class="content mb-5"><p>Recently Kaggle master Kazanova along with some of his friends released a
<a href="https://www.coursera.org/specializations/aml?siteID=lVarvwc5BD0-BShznKdc3CUauhfsM7_8xw&utm_content=2&utm_medium=partners&utm_source=linkshare&utm_campaign=lVarvwc5BD0" target=_blank rel="nofollow noopener">&amp;ldquo;How to win a data science competition&amp;rdquo;</a>
Coursera course. You can start for free with the 7-day Free Trial. The Course involved a final project which itself was a time series prediction problem. Here I will describe how I got a top 10 position as of writing this article.</p><div style=margin-top:9px;margin-bottom:10px><center><img src=/images/lboard.png height=800 width=600></center></div><h2 id=description-of-the-problem>Description of the Problem:</h2><p>In this competition we were given a challenging time-series dataset consisting of daily sales data, kindly provided by one of the largest Russian software firms - 1C Company.</p><p>We were asked you to predict total sales for every product and store in the next month.</p><p>The evaluation metric was RMSE where True target values are clipped into [0,20] range. This target range will be a lot important in understanding the submissions that I will prepare.</p><p>The main thing that I noticed was that the data preparation aspect of this competition was by far the most important thing. I creted a variety of features. Here are the steps I took and the features I created.</p><h2 id=1-created-a-dataframe-of-all-date_block_num-store-and--item-combinations>1. Created a dataframe of all Date_block_num, Store and Item combinations:</h2><p>This is important because in the months we don&rsquo;t have a data for an item store combination, the machine learning algorithm needs to be specifically told that the sales is zero.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=color:#f92672>from</span> itertools <span style=color:#f92672>import</span> product
<span style=color:#75715e># Create &#34;grid&#34; with columns</span>
index_cols <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;shop_id&#39;</span>, <span style=color:#e6db74>&#39;item_id&#39;</span>, <span style=color:#e6db74>&#39;date_block_num&#39;</span>]

<span style=color:#75715e># For every month we create a grid from all shops/items combinations from that month</span>
grid <span style=color:#f92672>=</span> []
<span style=color:#66d9ef>for</span> block_num <span style=color:#f92672>in</span> sales[<span style=color:#e6db74>&#39;date_block_num&#39;</span>]<span style=color:#f92672>.</span>unique():
    cur_shops <span style=color:#f92672>=</span> sales<span style=color:#f92672>.</span>loc[sales[<span style=color:#e6db74>&#39;date_block_num&#39;</span>] <span style=color:#f92672>==</span> block_num, <span style=color:#e6db74>&#39;shop_id&#39;</span>]<span style=color:#f92672>.</span>unique()
    cur_items <span style=color:#f92672>=</span> sales<span style=color:#f92672>.</span>loc[sales[<span style=color:#e6db74>&#39;date_block_num&#39;</span>] <span style=color:#f92672>==</span> block_num, <span style=color:#e6db74>&#39;item_id&#39;</span>]<span style=color:#f92672>.</span>unique()
    grid<span style=color:#f92672>.</span>append(np<span style=color:#f92672>.</span>array(list(product(<span style=color:#f92672>*</span>[cur_shops, cur_items, [block_num]])),dtype<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;int32&#39;</span>))
grid <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(np<span style=color:#f92672>.</span>vstack(grid), columns <span style=color:#f92672>=</span> index_cols,dtype<span style=color:#f92672>=</span>np<span style=color:#f92672>.</span>int32)
</code></pre></div><h2 id=2-cleaned-up-a-little-of-sales-data-after-some-basic-eda>2. Cleaned up a little of sales data after some basic EDA:</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py>sales <span style=color:#f92672>=</span> sales[sales<span style=color:#f92672>.</span>item_price<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>100000</span>]
sales <span style=color:#f92672>=</span> sales[sales<span style=color:#f92672>.</span>item_cnt_day<span style=color:#f92672>&lt;=</span><span style=color:#ae81ff>1000</span>]
</code></pre></div><h2 id=3-created-mean-encodings>3. Created Mean Encodings:</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py>sales_m <span style=color:#f92672>=</span> sales<span style=color:#f92672>.</span>groupby([<span style=color:#e6db74>&#39;date_block_num&#39;</span>,<span style=color:#e6db74>&#39;shop_id&#39;</span>,<span style=color:#e6db74>&#39;item_id&#39;</span>])<span style=color:#f92672>.</span>agg({<span style=color:#e6db74>&#39;item_cnt_day&#39;</span>: <span style=color:#e6db74>&#39;sum&#39;</span>,<span style=color:#e6db74>&#39;item_price&#39;</span>: np<span style=color:#f92672>.</span>mean})<span style=color:#f92672>.</span>reset_index()
sales_m <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>merge(grid,sales_m,on<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;date_block_num&#39;</span>,<span style=color:#e6db74>&#39;shop_id&#39;</span>,<span style=color:#e6db74>&#39;item_id&#39;</span>],how<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;left&#39;</span>)<span style=color:#f92672>.</span>fillna(<span style=color:#ae81ff>0</span>)
<span style=color:#75715e># adding the category id too</span>
sales_m <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>merge(sales_m,items,on<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;item_id&#39;</span>],how<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;left&#39;</span>)

<span style=color:#66d9ef>for</span> type_id <span style=color:#f92672>in</span> [<span style=color:#e6db74>&#39;item_id&#39;</span>,<span style=color:#e6db74>&#39;shop_id&#39;</span>,<span style=color:#e6db74>&#39;item_category_id&#39;</span>]:
    <span style=color:#66d9ef>for</span> column_id,aggregator,aggtype <span style=color:#f92672>in</span> [(<span style=color:#e6db74>&#39;item_price&#39;</span>,np<span style=color:#f92672>.</span>mean,<span style=color:#e6db74>&#39;avg&#39;</span>),(<span style=color:#e6db74>&#39;item_cnt_day&#39;</span>,np<span style=color:#f92672>.</span>sum,<span style=color:#e6db74>&#39;sum&#39;</span>),(<span style=color:#e6db74>&#39;item_cnt_day&#39;</span>,np<span style=color:#f92672>.</span>mean,<span style=color:#e6db74>&#39;avg&#39;</span>)]:

        mean_df <span style=color:#f92672>=</span> sales<span style=color:#f92672>.</span>groupby([type_id,<span style=color:#e6db74>&#39;date_block_num&#39;</span>])<span style=color:#f92672>.</span>aggregate(aggregator)<span style=color:#f92672>.</span>reset_index()[[column_id,type_id,<span style=color:#e6db74>&#39;date_block_num&#39;</span>]]
        mean_df<span style=color:#f92672>.</span>columns <span style=color:#f92672>=</span> [type_id<span style=color:#f92672>+</span><span style=color:#e6db74>&#39;_&#39;</span><span style=color:#f92672>+</span>aggtype<span style=color:#f92672>+</span><span style=color:#e6db74>&#39;_&#39;</span><span style=color:#f92672>+</span>column_id,type_id,<span style=color:#e6db74>&#39;date_block_num&#39;</span>]

        sales_m <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>merge(sales_m,mean_df,on<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;date_block_num&#39;</span>,type_id],how<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;left&#39;</span>)
</code></pre></div><p>These above lines add the following 9 features :</p><ul><li>&lsquo;item_id_avg_item_price&rsquo;</li><li>&lsquo;item_id_sum_item_cnt_day&rsquo;</li><li>&lsquo;item_id_avg_item_cnt_day&rsquo;</li><li>&lsquo;shop_id_avg_item_price&rsquo;,</li><li>&lsquo;shop_id_sum_item_cnt_day&rsquo;</li><li>&lsquo;shop_id_avg_item_cnt_day&rsquo;</li><li>&lsquo;item_category_id_avg_item_price&rsquo;</li><li>&lsquo;item_category_id_sum_item_cnt_day&rsquo;</li><li>&lsquo;item_category_id_avg_item_cnt_day&rsquo;</li></ul><h2 id=4-create-lag-features>4. Create Lag Features:</h2><p>Next we create lag features with diferent lag periods on the following features:</p><ul><li>&lsquo;item_id_avg_item_price&rsquo;,</li><li>&lsquo;item_id_sum_item_cnt_day&rsquo;</li><li>&lsquo;item_id_avg_item_cnt_day&rsquo;</li><li>&lsquo;shop_id_avg_item_price&rsquo;</li><li>&lsquo;shop_id_sum_item_cnt_day&rsquo;</li><li>&lsquo;shop_id_avg_item_cnt_day&rsquo;</li><li>&lsquo;item_category_id_avg_item_price&rsquo;</li><li>&lsquo;item_category_id_sum_item_cnt_day&rsquo;</li><li>&lsquo;item_category_id_avg_item_cnt_day&rsquo;</li><li>&lsquo;item_cnt_day&rsquo;</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py>lag_variables  <span style=color:#f92672>=</span> list(sales_m<span style=color:#f92672>.</span>columns[<span style=color:#ae81ff>7</span>:])<span style=color:#f92672>+</span>[<span style=color:#e6db74>&#39;item_cnt_day&#39;</span>]
lags <span style=color:#f92672>=</span> [<span style=color:#ae81ff>1</span> ,<span style=color:#ae81ff>2</span> ,<span style=color:#ae81ff>3</span> ,<span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>12</span>]
<span style=color:#66d9ef>for</span> lag <span style=color:#f92672>in</span> lags:
    sales_new_df <span style=color:#f92672>=</span> sales_m<span style=color:#f92672>.</span>copy()
    sales_new_df<span style=color:#f92672>.</span>date_block_num<span style=color:#f92672>+=</span>lag
    sales_new_df <span style=color:#f92672>=</span> sales_new_df[[<span style=color:#e6db74>&#39;date_block_num&#39;</span>,<span style=color:#e6db74>&#39;shop_id&#39;</span>,<span style=color:#e6db74>&#39;item_id&#39;</span>]<span style=color:#f92672>+</span>lag_variables]
    sales_new_df<span style=color:#f92672>.</span>columns <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;date_block_num&#39;</span>,<span style=color:#e6db74>&#39;shop_id&#39;</span>,<span style=color:#e6db74>&#39;item_id&#39;</span>]<span style=color:#f92672>+</span> [lag_feat<span style=color:#f92672>+</span><span style=color:#e6db74>&#39;_lag_&#39;</span><span style=color:#f92672>+</span>str(lag) <span style=color:#66d9ef>for</span> lag_feat <span style=color:#f92672>in</span> lag_variables]
    sales_means <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>merge(sales_means, sales_new_df,on<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;date_block_num&#39;</span>,<span style=color:#e6db74>&#39;shop_id&#39;</span>,<span style=color:#e6db74>&#39;item_id&#39;</span>] ,how<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;left&#39;</span>)
</code></pre></div><h2 id=5-fill-na-with-zeros>5. Fill NA with zeros:</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=color:#66d9ef>for</span> feat <span style=color:#f92672>in</span> sales_means<span style=color:#f92672>.</span>columns:
    <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;item_cnt&#39;</span> <span style=color:#f92672>in</span> feat:
        sales_means[feat]<span style=color:#f92672>=</span>sales_means[feat]<span style=color:#f92672>.</span>fillna(<span style=color:#ae81ff>0</span>)
    <span style=color:#66d9ef>elif</span> <span style=color:#e6db74>&#39;item_price&#39;</span> <span style=color:#f92672>in</span> feat:
        sales_means[feat]<span style=color:#f92672>=</span>sales_means[feat]<span style=color:#f92672>.</span>fillna(sales_means[feat]<span style=color:#f92672>.</span>median())
</code></pre></div><h2 id=6-drop-the-columns-that-we-are-not-going-to-use-in-training>6. Drop the columns that we are not going to use in training:</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py>cols_to_drop <span style=color:#f92672>=</span> lag_variables[:<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>+</span> [<span style=color:#e6db74>&#39;item_name&#39;</span>,<span style=color:#e6db74>&#39;item_price&#39;</span>]
</code></pre></div><h2 id=7-take-a-recent-bit-of-data-only>7. Take a recent bit of data only:</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py>sales_means <span style=color:#f92672>=</span> sales_means[sales_means[<span style=color:#e6db74>&#39;date_block_num&#39;</span>]<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>12</span>]
</code></pre></div><h2 id=8-split-in-train-and-cv->8. Split in train and CV :</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py>X_train <span style=color:#f92672>=</span> sales_means[sales_means[<span style=color:#e6db74>&#39;date_block_num&#39;</span>]<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>33</span>]<span style=color:#f92672>.</span>drop(cols_to_drop, axis<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
X_cv <span style=color:#f92672>=</span>  sales_means[sales_means[<span style=color:#e6db74>&#39;date_block_num&#39;</span>]<span style=color:#f92672>==</span><span style=color:#ae81ff>33</span>]<span style=color:#f92672>.</span>drop(cols_to_drop, axis<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</code></pre></div><h2 id=9-the-magic-sauce>9. THE MAGIC SAUCE:</h2><p>In the start I told that the clipping aspect of [0,20] will be important.
In the next few lines I clipped the days to range[0,40]. You might ask me why 40. An intuitive answer is if I had clipped to range [0,20] there would be very few tree nodes that could give 20 as an answer. While if I increase it to 40 having a 20 becomes much more easier. Please note that We will clip our predictions in the [0,20] range in the end.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>clip</span>(x):
    <span style=color:#66d9ef>if</span> x<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>40</span>:
        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>40</span>
    <span style=color:#66d9ef>elif</span> x<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>0</span>:
        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
    <span style=color:#66d9ef>else</span>:
        <span style=color:#66d9ef>return</span> x
train[<span style=color:#e6db74>&#39;item_cnt_day&#39;</span>] <span style=color:#f92672>=</span> train<span style=color:#f92672>.</span>apply(<span style=color:#66d9ef>lambda</span> x: clip(x[<span style=color:#e6db74>&#39;item_cnt_day&#39;</span>]),axis<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
cv[<span style=color:#e6db74>&#39;item_cnt_day&#39;</span>] <span style=color:#f92672>=</span> cv<span style=color:#f92672>.</span>apply(<span style=color:#66d9ef>lambda</span> x: clip(x[<span style=color:#e6db74>&#39;item_cnt_day&#39;</span>]),axis<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</code></pre></div><h2 id=10-modelling>10: Modelling:</h2><ul><li>Created a XGBoost model to get the most important features(Top 42 features)</li><li>Use hyperopt to tune xgboost</li><li>Used top 10 models from tuned XGBoosts to generate predictions.</li><li>clipped the predictions to [0,20] range</li><li>Final solution was the average of these 10 predictions.</li></ul><p>Learned a lot of new things from this
<a href="https://www.coursera.org/specializations/aml?siteID=lVarvwc5BD0-BShznKdc3CUauhfsM7_8xw&utm_content=2&utm_medium=partners&utm_source=linkshare&utm_campaign=lVarvwc5BD0" target=_blank rel="nofollow noopener">awesome course</a>
. Most recommended.</p><script async data-uid=8d7942551b src=https://mlwhiz.ck.page/8d7942551b/index.js></script><div class=shareaholic-canvas data-app=share_buttons data-app-id=28372088 style=margin-bottom:1px></div><a href="https://click.linksynergy.com/fs-bin/click?id=lVarvwc5BD0&offerid=467035.372&subid=0&type=4" rel=nofollow><img border=0 alt="Start your future with a Data Science Certificate." src="https://ad.linksynergy.com/fs-bin/show?id=lVarvwc5BD0&bids=467035.372&subid=0&type=4&gridnum=16"></a><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"mlwhiz"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div class=col-lg-4><div class=widget><script type=text/javascript src=https://ko-fi.com/widgets/widget_2.js></script><script type=text/javascript>kofiwidget2.init('Support Me on Ko-fi','#00aaa1','S6S3NPCD');kofiwidget2.draw();</script></div><div class=widget><h4 class=widget-title>About Me</h4><img src=https://mlwhiz.com/images/author.jpg alt class="img-fluid author-thumb-sm d-block mx-auto rounded-circle mb-4"><p>I’m a data scientist consultant and big data engineer based in Bangalore, where I am currently working with WalmartLabs .</p><a href=https://mlwhiz.com/about/ class="btn btn-outline-primary">Know More</a></div><div class=widget><h4 class=widget-title>Topics</h4><ul class=list-unstyled><li><a class=categoryStyle style=color:#fff href=/categories/awesome-guides>Awesome Guides</a></li><li><a class=categoryStyle style=color:#fff href=/categories/big-data>Big Data</a></li><li><a class=categoryStyle style=color:#fff href=/categories/computer-vision>Computer Vision</a></li><li><a class=categoryStyle style=color:#fff href=/categories/data-science>Data Science</a></li><li><a class=categoryStyle style=color:#fff href=/categories/deep-learning>Deep Learning</a></li><li><a class=categoryStyle style=color:#fff href=/categories/learning-resources>Learning Resources</a></li><li><a class=categoryStyle style=color:#fff href=/categories/natural-language-processing>Natural Language Processing</a></li><li><a class=categoryStyle style=color:#fff href=/categories/programming>Programming</a></li></ul></div><div class=widget><h4 class=widget-title>Tags</h4><ul class=list-inline><li class=list-inline-item><a class="tagStyle text-white" href=/tags/algorithms>Algorithms</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/artificial-intelligence>Artificial Intelligence</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/dask>Dask</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/deployment>Deployment</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/ec2>Ec2</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/generative-adversarial-networks>Generative Adversarial Networks</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/graphs>Graphs</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/image-classification>Image Classification</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/instance-segmentation>Instance Segmentation</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/interpretability>Interpretability</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/jobs>Jobs</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/kaggle>Kaggle</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/language-modeling>Language Modeling</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/machine-learning>Machine Learning</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/math>Math</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/multiprocessing>Multiprocessing</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/object-detection>Object Detection</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/opinion>Opinion</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/pandas>Pandas</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/production>Production</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/productivity>Productivity</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/python>Python</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/pytorch>Pytorch</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/spark>Spark</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/sql>Sql</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/statistics>Statistics</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/streamlit>Streamlit</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/text-classification>Text Classification</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/timeseries>Timeseries</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/tools>Tools</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/translation>Translation</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/visualization>Visualization</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/xgboost>Xgboost</a></li></ul></div><div class=widget><h4 class=widget-title>Connect With Me</h4><ul class="list-inline social-links"><li class=list-inline-item><a href=https://www.linkedin.com/in/rahulagwl/><i class=ti-linkedin></i></a></li><li class=list-inline-item><a href=https://medium.com/@rahul_agarwal><i class=ti-book></i></a></li><li class=list-inline-item><a href=https://twitter.com/MLWhiz><i class=ti-twitter-alt></i></a></li><li class=list-inline-item><a href=https://www.facebook.com/mlwhizblog><i class=ti-facebook></i></a></li><li class=list-inline-item><a href=https://github.com/MLWhiz><i class=ti-github></i></a></li></ul></div><script async data-uid=bfe9f82f10 src=https://mlwhiz.ck.page/bfe9f82f10/index.js></script><script async data-uid=3452d924e2 src=https://mlwhiz.ck.page/3452d924e2/index.js></script></div></div></div></section><footer><div class=container><div class=row><div class="col-12 text-center mb-5"><a href=https://mlwhiz.com/><img src=https://mlwhiz.com/images/logo.png class=img-fluid-custom-bottom alt="MLWhiz: Helping You Learn Data Science!"></a></div><div class="col-lg-3 col-sm-6 mb-5"><h6 class=mb-4>Contact Me</h6><ul class=list-unstyled><li class=mb-3><i class="ti-location-pin mr-3 text-primary"></i>India, Bangalore</li><li class=mb-3><a class=text-dark href=mailto:rahul@mlwhiz.com><i class="ti-email mr-3 text-primary"></i>rahul@mlwhiz.com</a></li></ul></div><div class="col-lg-3 col-sm-6 mb-5"><h6 class=mb-4>Social Contacts</h6><ul class=list-unstyled><li class=mb-3><a class=text-dark href=https://www.linkedin.com/in/rahulagwl/>Linkedin</a></li><li class=mb-3><a class=text-dark href=https://medium.com/@rahul_agarwal>Medium</a></li><li class=mb-3><a class=text-dark href=https://twitter.com/MLWhiz>Twitter</a></li><li class=mb-3><a class=text-dark href=https://www.facebook.com/mlwhizblog>Facebook</a></li><li class=mb-3><a class=text-dark href=https://github.com/MLWhiz>Github</a></li></ul></div><div class="col-lg-3 col-sm-6 mb-5"><h6 class=mb-4>Categories</h6><ul class=list-unstyled><li class=mb-3><a class=text-dark href=/categories/awesome-guides>Awesome Guides</a></li><li class=mb-3><a class=text-dark href=/categories/big-data>Big Data</a></li><li class=mb-3><a class=text-dark href=/categories/computer-vision>Computer Vision</a></li><li class=mb-3><a class=text-dark href=/categories/data-science>Data Science</a></li><li class=mb-3><a class=text-dark href=/categories/deep-learning>Deep Learning</a></li><li class=mb-3><a class=text-dark href=/categories/learning-resources>Learning Resources</a></li><li class=mb-3><a class=text-dark href=/categories/natural-language-processing>Natural Language Processing</a></li><li class=mb-3><a class=text-dark href=/categories/programming>Programming</a></li></ul></div><div class="col-lg-3 col-sm-6 mb-5"><h6 class=mb-4>Quick Links</h6><ul class=list-unstyled><li class=mb-3><a class=text-dark href=https://mlwhiz.com/about>About</a></li><li class=mb-3><a class=text-dark href=https://mlwhiz.com/blog>Post</a></li></ul></div><div class="col-12 border-top py-4 text-center">Copyright © 2020 <a href=https://mlwhiz.com>MLWhiz</a> All Rights Reserved</div></div></div></footer><script>var indexURL="https://mlwhiz.com/index.json"</script><script src=https://mlwhiz.com/plugins/compressjscss/main.js></script><script src=https://mlwhiz.com/js/script.min.js></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-54777926-1','auto');ga('send','pageview');</script></body></html>