<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Adding Interpretability to Multiclass Text Classification models - MLWhiz</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="This post is about interpreting complex text classification models."><meta name=author content="Rahul Agarwal"><meta name=generator content="Hugo 0.74.3"><link rel=stylesheet href=https://mlwhiz.com/plugins/compressjscss/main.css><meta property="og:title" content="Adding Interpretability to Multiclass Text Classification models - MLWhiz"><meta property="og:description" content="This post is about interpreting complex text classification models."><meta property="og:type" content="article"><meta property="og:url" content="https://mlwhiz.com/blog/2019/11/08/interpret_models/"><meta property="og:image" content="https://mlwhiz.com/images/interpret/main.png"><meta property="og:image:secure_url" content="https://mlwhiz.com/images/interpret/main.png"><meta property="article:published_time" content="2019-11-08T00:00:00+00:00"><meta property="article:modified_time" content="2022-04-13T13:34:49+01:00"><meta property="article:tag" content="Data Science"><meta property="article:tag" content="Natural Language Processing"><meta name=twitter:card content="summary"><meta name=twitter:image content="https://mlwhiz.com/images/interpret/main.png"><meta name=twitter:title content="Adding Interpretability to Multiclass Text Classification models - MLWhiz"><meta name=twitter:description content="This post is about interpreting complex text classification models."><meta name=twitter:site content="@mlwhiz"><meta name=twitter:creator content="@mlwhiz"><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href=https://mlwhiz.com/scss/style.min.css media=screen><link rel=stylesheet href=/css/style.css><link rel=stylesheet type=text/css href=/css/font/flaticon.css><link rel="shortcut icon" href=https://mlwhiz.com/images/favicon-200x200.png type=image/x-icon><link rel=icon href=https://mlwhiz.com/images/favicon.png type=image/x-icon><link rel=canonical href=https://mlwhiz.com/blog/2019/11/08/interpret_models/><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://www.mlwhiz.com/#website","url":"https://www.mlwhiz.com/","name":"MLWhiz","description":"Want to Learn Computer Vision and NLP? - MLWhiz","potentialAction":{"@type":"SearchAction","target":"https://www.mlwhiz.com/search?s={search_term_string}","query-input":"required name=search_term_string"}},{"@type":"ImageObject","@id":"https://mlwhiz.com/blog/2019/11/08/interpret_models/#primaryimage","url":"https://mlwhiz.com/images/interpret/main.png","width":700,"height":450},{"@type":"WebPage","@id":"https://mlwhiz.com/blog/2019/11/08/interpret_models/#webpage","url":"https://mlwhiz.com/blog/2019/11/08/interpret_models/","inLanguage":"en-US","name":"Adding Interpretability to Multiclass Text Classification models - MLWhiz","isPartOf":{"@id":"https://www.mlwhiz.com/#website"},"primaryImageOfPage":{"@id":"https://mlwhiz.com/blog/2019/11/08/interpret_models/#primaryimage"},"datePublished":"2019-11-08T00:00:00.00Z","dateModified":"2022-04-13T13:34:49.00Z","author":{"@id":"https://mlwhiz.com/about/#/schema/person/76376876bchxkzbchjsdjcca"},"description":"This post is about interpreting complex text classification models."},{"@type":["Person"],"@id":"https://mlwhiz.com/about/#/schema/person/76376876bchxkzbchjsdjcca","name":"Rahul Agarwal","image":{"@type":"ImageObject","@id":"https://www.mlwhiz.com/#authorlogo","url":"https://mlwhiz.com/images/author.jpg","caption":"Rahul Agarwal"},"description":"Hi there, I\u2019m Rahul Agarwal. I\u2019m a data scientist consultant and big data engineer based in Bangalore. I see a lot of times  students and even professionals wasting their time and struggling to get started with Computer Vision, Deep Learning, and NLP. I Started this Site with a purpose to augment my own understanding about new things while helping others learn about them in the best possible way.","sameAs":["https://www.linkedin.com/in/rahulagwl/","https://medium.com/@rahul_agarwal","https://twitter.com/MLWhiz","https://www.facebook.com/mlwhizblog","https://github.com/MLWhiz","https://www.instagram.com/itsmlwhiz"]}]}</script><script async data-uid=a0ebaf958d src=https://mlwhiz.ck.page/a0ebaf958d/index.js></script><script type=text/javascript async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$']],processEscapes:true,processEnvironments:true,skipTags:['script','noscript','style','textarea','pre'],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}});MathJax.Hub.Queue(function(){var all=MathJax.Hub.getAllJax(),i;for(i=0;i<all.length;i+=1){all[i].SourceElement().parentNode.className+=' has-jax';}});MathJax.Hub.Config({TeX:{equationNumbers:{autoNumber:"AMS"}}});</script><link href=//apps.shareaholic.com/assets/pub/shareaholic.js as=script><script type=text/javascript data-cfasync=false async src=//apps.shareaholic.com/assets/pub/shareaholic.js data-shr-siteid=fd1ffa7fd7152e4e20568fbe49a489d0></script><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');fbq('init','402633927768628');fbq('track','PageView');</script><noscript><img height=1 width=1 style=display:none src="https://www.facebook.com/tr?id=402633927768628&ev=PageView&noscript=1"></noscript><meta property="fb:pages" content="213104036293742"><meta name=facebook-domain-verification content="qciidcy7mm137sewruizlvh8zbfnv4"></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NMQD44T" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><div class=preloader></div><header class=navigation><div class=container><nav class="navbar navbar-expand-lg navbar-white bg-transparent border-bottom pl-0"><a class="navbar-brand mobile-view" href=https://mlwhiz.com/><img class=img-fluid src=https://mlwhiz.com/images/logo.png alt="Helping You Learn Data Science!"></a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class="ti-menu h3"></i></button><div class="collapse navbar-collapse text-center" id=navigation><div class=desktop-view><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=https://www.linkedin.com/in/rahulagwl/><i class=ti-linkedin></i></a></li><li class=nav-item><a class=nav-link href=https://mlwhiz.medium.com/><i class=ti-book></i></a></li><li class=nav-item><a class=nav-link href=https://twitter.com/MLWhiz><i class=ti-twitter-alt></i></a></li><li class=nav-item><a class=nav-link href=https://www.facebook.com/mlwhizblog><i class=ti-facebook></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/MLWhiz><i class=ti-github></i></a></li></ul></div><a class="navbar-brand mx-auto desktop-view" href=https://mlwhiz.com/><img class=img-fluid-custom src=https://mlwhiz.com/images/logo.png alt="Helping You Learn Data Science!"></a><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://mlwhiz.com/about>About</a></li><li class=nav-item><a class=nav-link href=https://mlwhiz.com/blog>Blog</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Topics</a><div class=dropdown-menu><a class=dropdown-item href=https://mlwhiz.com/categories/natural-language-processing>NLP</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/computer-vision>Computer Vision</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/deep-learning>Deep Learning</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/data-science>DS/ML</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/big-data>Big Data</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/awesome-guides>My Best Content</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/learning-resources>Learning Resources</a></div></li></ul><div class="search pl-lg-4"><button id=searchOpen class=search-btn><i class=ti-search></i></button><div class=search-wrapper><form action=https://mlwhiz.com//search class=h-100><input class="search-box px-4" id=search-query name=s type=search placeholder="Type & Hit Enter..."></form><button id=searchClose class=search-close><i class="ti-close text-dark"></i></button></div></div></div></nav></div></header><section class=section-sm><div class=container><div class=row><div class="col-lg-8 mb-5 mb-lg-0"><a href=/categories/data-science class=categoryStyle>Data Science</a>
<a href=/categories/natural-language-processing class=categoryStyle>Natural Language Processing</a><h1>Adding Interpretability to Multiclass Text Classification models</h1><div class="mb-3 post-meta"><span>By Rahul Agarwal</span><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg>
<span>08 November 2019</span></div><img src=https://mlwhiz.com/images/interpret/main.png class="img-fluid w-100 mb-4" alt="Adding Interpretability to Multiclass Text Classification models"><div class="content mb-5"><p>Explain Like I am 5.</p><p>It is the basic tenets of learning for me where I try to distill any concept in a more palatable form. As Feynman said:</p><blockquote><p>I couldn’t do it. I couldn’t reduce it to the freshman level. That means we don’t really understand it.</p></blockquote><p>So, when I saw the ELI5 library that aims to interpret machine learning models, I just had to try it out.</p><p>One of the basic problems we face while explaining our complex machine learning classifiers to the business is <em><strong>interpretability</strong></em>.</p><p>Sometimes the stakeholders want to understand — what is causing a particular result? <em><strong>It may be because the task at hand is very critical and we cannot afford to take a wrong decision.</strong></em> Think of a classifier that takes automated monetary actions based on user reviews.</p><p><em><strong>Or it may be to understand a little bit more about the business/the problem space.</strong></em></p><p>Or it may be to increase the <em><strong>social acceptance</strong></em> of your model.</p><p><em><strong>This post is about interpreting complex text classification models.</strong></em></p><hr><h2 id=the-dataset>The Dataset:</h2><p>To explain how ELI5 works, I will be working with the stack overflow dataset on Kaggle. This dataset contains around 40000 posts and the corresponding tag for the post.</p><p>This is how the dataset looks:</p><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset="/images/interpret/0_hu5e0e4c58b5fce5594eb459cfe47c4ddf_42033_500x0_resize_box_2.png 500w" src=/images/interpret/0.png alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p>And given below is the distribution for different categories.</p><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset="/images/interpret/1_hude09579d1b8f8026195dd20429227502_138665_500x0_resize_box_2.png 500w
, /images/interpret/1_hude09579d1b8f8026195dd20429227502_138665_800x0_resize_box_2.png 800w
, /images/interpret/1_hude09579d1b8f8026195dd20429227502_138665_1200x0_resize_box_2.png 1200w
, /images/interpret/1_hude09579d1b8f8026195dd20429227502_138665_1500x0_resize_box_2.png 1500w" src=/images/interpret/1.png alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p>This is a balanced dataset and thus suited well for our purpose of understanding.</p><p>So let us start. You can follow along with the code in this
<a href=https://www.kaggle.com/mlwhiz/interpreting-text-classification-models-with-eli5 target=_blank rel="nofollow noopener">Kaggle Kernel</a></p><hr><h2 id=staring-simple>Staring Simple:</h2><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset="/images/interpret/2_huabfc9b6b03999f6a0314dfead21c4f1d_68099_500x0_resize_box_2.png 500w
, /images/interpret/2_huabfc9b6b03999f6a0314dfead21c4f1d_68099_800x0_resize_box_2.png 800w
, /images/interpret/2_huabfc9b6b03999f6a0314dfead21c4f1d_68099_1200x0_resize_box_2.png 1200w" src=/images/interpret/2.png alt='<a href="https://christophm.github.io/interpretable-ml-book/terminology.html" target="_blank" rel="nofollow noopener">Interpretable ML Book</a>'></p><p>Let us first try to use a simple scikit-learn pipeline to build our text classifier which we will try to interpret later. <em><strong>In this pipeline, I will be using a very simple count vectorizer along with Logistic regression.</strong></em></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=color:#f92672>from</span> sklearn.model_selection <span style=color:#f92672>import</span> train_test_split
<span style=color:#f92672>from</span> sklearn.feature_extraction.text <span style=color:#f92672>import</span> CountVectorizer
<span style=color:#f92672>from</span> sklearn.linear_model <span style=color:#f92672>import</span> LogisticRegressionCV
<span style=color:#f92672>from</span> sklearn.pipeline <span style=color:#f92672>import</span> make_pipeline

<span style=color:#75715e># Creating train-test Split</span>
X <span style=color:#f92672>=</span> sodata[[<span style=color:#e6db74>&#39;post&#39;</span>]]
y <span style=color:#f92672>=</span> sodata[[<span style=color:#e6db74>&#39;tags&#39;</span>]]

X_train, X_test, y_train, y_test <span style=color:#f92672>=</span> train_test_split(X, y, test_size<span style=color:#f92672>=</span><span style=color:#ae81ff>0.2</span>, random_state<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)

<span style=color:#75715e># fitting the classifier</span>
vec <span style=color:#f92672>=</span> CountVectorizer()
clf <span style=color:#f92672>=</span> LogisticRegressionCV()
pipe <span style=color:#f92672>=</span> make_pipeline(vec, clf)
pipe<span style=color:#f92672>.</span>fit(X_train<span style=color:#f92672>.</span>post, y_train<span style=color:#f92672>.</span>tags)
</code></pre></div><p>Let’s see the results we get:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=color:#f92672>from</span> sklearn <span style=color:#f92672>import</span> metrics

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>print_report</span>(pipe):
    y_actuals <span style=color:#f92672>=</span> y_test[<span style=color:#e6db74>&#39;tags&#39;</span>]
    y_preds <span style=color:#f92672>=</span> pipe<span style=color:#f92672>.</span>predict(X_test[<span style=color:#e6db74>&#39;post&#39;</span>])
    report <span style=color:#f92672>=</span> metrics<span style=color:#f92672>.</span>classification_report(y_actuals, y_preds)
    <span style=color:#66d9ef>print</span>(report)
    <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#34;accuracy: {:0.3f}&#34;</span><span style=color:#f92672>.</span>format(metrics<span style=color:#f92672>.</span>accuracy_score(y_actuals, y_preds)))

print_report(pipe)
</code></pre></div><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset="/images/interpret/3_hub646db0803b27b69df38720203e9d94a_153998_500x0_resize_box_2.png 500w
, /images/interpret/3_hub646db0803b27b69df38720203e9d94a_153998_800x0_resize_box_2.png 800w" src=/images/interpret/3.png alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p>The above is a pretty simple Logistic regression model and it performs pretty well. <em><strong>We can check out its weights using the below function:</strong></em></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=color:#66d9ef>for</span> i, tag <span style=color:#f92672>in</span> enumerate(clf<span style=color:#f92672>.</span>classes_):
    coefficients <span style=color:#f92672>=</span> clf<span style=color:#f92672>.</span>coef_[i]
    weights <span style=color:#f92672>=</span> list(zip(vec<span style=color:#f92672>.</span>get_feature_names(),coefficients))
    <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;Tag:&#39;</span>,tag)
    <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;Most Positive Coefficients:&#39;</span>)
    <span style=color:#66d9ef>print</span>(sorted(weights,key<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> x: <span style=color:#f92672>-</span>x[<span style=color:#ae81ff>1</span>])[:<span style=color:#ae81ff>10</span>])
    <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;Most Negative Coefficients:&#39;</span>)
    <span style=color:#66d9ef>print</span>(sorted(weights,key<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> x: x[<span style=color:#ae81ff>1</span>])[:<span style=color:#ae81ff>10</span>])
    <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#34;--------------------------------------&#34;</span>)
</code></pre></div><pre><code>------------------------------------------------------------
OUTPUT:
------------------------------------------------------------

Tag: python
Most Positive Coefficients:
[('python', 6.314761719932758), ('def', 2.288467823831321), ('import', 1.4032539284357077), ('dict', 1.1915110448370732), ('ordered', 1.1558015932799253), ('print', 1.1219958415166653), ('tuples', 1.053837204818975), ('elif', 0.9642251085198578), ('typeerror', 0.9595246314353266), ('tuple', 0.881802590839166)]
Most Negative Coefficients:
[('java', -1.8496383139251245), ('php', -1.4335540858871623), ('javascript', -1.3374796382615586), ('net', -1.2542682749949605), ('printf', -1.2014123042575882), ('objective', -1.1635960146614717), ('void', -1.1433460304246827), ('var', -1.059642972412936), ('end', -1.0498078813349798), ('public', -1.0134828865993966)]
--------------------------------------
Tag: ruby-on-rails
Most Positive Coefficients:
[('rails', 6.364037640161158), ('ror', 1.804826792986176), ('activerecord', 1.6892552000017307), ('ruby', 1.41428459023012), ('erb', 1.3927336940889532), ('end', 1.3650227017877463), ('rb', 1.2280121863441906), ('gem', 1.1988196865523322), ('render', 1.1035255831838242), ('model', 1.0813278895692746)]
Most Negative Coefficients:
[('net', -1.5818801311532575), ('php', -1.3483618692617583), ('python', -1.201167422237274), ('mysql', -1.187479885113293), ('objective', -1.1727511956332588), ('sql', -1.1418573958542007), ('messageform', -1.0551060751109618), ('asp', -1.0342831159678236), ('ios', -1.0319120624686084), ('iphone', -0.9400116321217807)]
--------------------------------------
.......
</code></pre><p>And that is all pretty good. We can see the coefficients make sense and we can try to improve our model using this information.</p><p>But above was a lot of code. <em><strong>ELI5 makes this exercise pretty simple for us</strong></em>. We just have to use the below command:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=color:#f92672>import</span> eli5
eli5<span style=color:#f92672>.</span>show_weights(clf, vec<span style=color:#f92672>=</span>vec, top<span style=color:#f92672>=</span><span style=color:#ae81ff>20</span>)
</code></pre></div><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset="/images/interpret/4_hu61b18496e4ecaaa0b5a0606e12886f3e_495706_500x0_resize_box_2.png 500w
, /images/interpret/4_hu61b18496e4ecaaa0b5a0606e12886f3e_495706_800x0_resize_box_2.png 800w
, /images/interpret/4_hu61b18496e4ecaaa0b5a0606e12886f3e_495706_1200x0_resize_box_2.png 1200w
, /images/interpret/4_hu61b18496e4ecaaa0b5a0606e12886f3e_495706_1500x0_resize_box_2.png 1500w" src=/images/interpret/4.png alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p>Now as you can see the weights value for Python is the same as from the values we got from the function we wrote manually. And it is much prettier and wholesome to explore.</p><p>But that is just the tip of the iceberg. ELI5 can also help us to debug our models as we can see below.</p><h2 id=understanding-our-simple-text-classification-model>Understanding our Simple Text Classification Model</h2><p>Let us now try to find out why a particular example is misclassified. I am using an example which was originally from the class Python but got misclassified as Java:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py>y_preds <span style=color:#f92672>=</span> pipe<span style=color:#f92672>.</span>predict(sodata[<span style=color:#e6db74>&#39;post&#39;</span>])

sodata[<span style=color:#e6db74>&#39;predicted_label&#39;</span>] <span style=color:#f92672>=</span> y_preds

misclassified_examples <span style=color:#f92672>=</span> sodata[(sodata[<span style=color:#e6db74>&#39;tags&#39;</span>]<span style=color:#f92672>!=</span>sodata[<span style=color:#e6db74>&#39;predicted_label&#39;</span>])<span style=color:#f92672>&amp;</span>(sodata[<span style=color:#e6db74>&#39;tags&#39;</span>]<span style=color:#f92672>==</span><span style=color:#e6db74>&#39;python&#39;</span>)<span style=color:#f92672>&amp;</span>(sodata[<span style=color:#e6db74>&#39;predicted_label&#39;</span>]<span style=color:#f92672>==</span><span style=color:#e6db74>&#39;java&#39;</span>)]

eli5<span style=color:#f92672>.</span>show_prediction(clf, misclassified_examples[<span style=color:#e6db74>&#39;post&#39;</span>]<span style=color:#f92672>.</span>values[<span style=color:#ae81ff>1</span>], vec<span style=color:#f92672>=</span>vec)
</code></pre></div><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset="/images/interpret/5_hu2e348bcc3192e0632c68c77c935061c3_221142_500x0_resize_box_2.png 500w
, /images/interpret/5_hu2e348bcc3192e0632c68c77c935061c3_221142_800x0_resize_box_2.png 800w
, /images/interpret/5_hu2e348bcc3192e0632c68c77c935061c3_221142_1200x0_resize_box_2.png 1200w
, /images/interpret/5_hu2e348bcc3192e0632c68c77c935061c3_221142_1500x0_resize_box_2.png 1500w" src=/images/interpret/5.png alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset="/images/interpret/6_hua0f4acc38d21c4adad1142c15f914392_222991_500x0_resize_box_2.png 500w
, /images/interpret/6_hua0f4acc38d21c4adad1142c15f914392_222991_800x0_resize_box_2.png 800w
, /images/interpret/6_hua0f4acc38d21c4adad1142c15f914392_222991_1200x0_resize_box_2.png 1200w
, /images/interpret/6_hua0f4acc38d21c4adad1142c15f914392_222991_1500x0_resize_box_2.png 1500w" src=/images/interpret/6.png alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p>In the above example, the classifier predicts Java with a low probability. And we can examine a lot of things going on in the above example to improve our model. For example:</p><ol><li><p>We get to see that the classifier is taking a lot of digits into consideration(not good)which brings us to the conclusion of cleaning up the digits. Or replacing DateTime objects with a DateTime token.</p></li><li><p>Also see that while dictionary has a negative weight for Java, the word dictionaries has a positive weight. So maybe stemming could also help.</p></li><li><p>We also see that there are words like <code>&lt;pre>&lt;code></code> that are influencing our classifier. These words should be removed while cleaning.</p></li><li><p>Why is the word date influencing the results? Something to think about.</p></li></ol><p>We can take a look at more examples to get more such ideas. You get the gist.</p><h2 id=going-deep-and-complex>Going Deep And Complex</h2><p>This is all good and fine but*** what if models that we use don’t provide weights for the individual features like LSTM?*** It is with these models that explainability can play a very important role.</p><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset="/images/interpret/7_hu2f21e1cf1a24b34411d1892945b6862e_153160_500x0_resize_box_2.png 500w
, /images/interpret/7_hu2f21e1cf1a24b34411d1892945b6862e_153160_800x0_resize_box_2.png 800w
, /images/interpret/7_hu2f21e1cf1a24b34411d1892945b6862e_153160_1200x0_resize_box_2.png 1200w
, /images/interpret/7_hu2f21e1cf1a24b34411d1892945b6862e_153160_1500x0_resize_box_2.png 1500w" src=/images/interpret/7.png alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p>To understand how to do this, we first create a TextCNN model on our data. <em>Not showing the model creation process in the interest of preserving space</em> but think of it as a series of preprocessing steps and then creating the deep learning model. If interested, you can check out the modelling steps in this
<a href=https://www.kaggle.com/mlwhiz/interpreting-text-classification-models-with-eli5 target=_blank rel="nofollow noopener">Kaggle kernel</a>
.</p><p><em><strong>Things get interesting from our point of view when we have a trained black-box model object.</strong></em></p><p>ELI5 provides us with the <code>eli5.lime.TextExplainer</code> to debug our prediction - to check what was important in the document to make a prediction decision.</p><p>To use
<a href=https://eli5.readthedocs.io/en/latest/autodocs/lime.html#eli5.lime.lime.TextExplainer target=_blank rel="nofollow noopener">&lt;strong>TextExplainer&lt;/strong></a>
instance, we pass a document to explain and a black-box classifier (a predict function which returns probabilities) to the
<a href=https://eli5.readthedocs.io/en/latest/autodocs/lime.html#eli5.lime.lime.TextExplainer.fit target=_blank rel="nofollow noopener">&lt;strong>fit()&lt;/strong></a>
method. From the documentation this is how our predict function should look like:</p><blockquote><p><strong>predict</strong> (<em>callable</em>) — Black-box classification pipeline. <em><strong>predict</strong></em> should be a function which takes a list of strings (documents) and return a matrix of shape <em><strong>(n_samples, n_classes)</strong></em> with probability values - a row per document and a column per output label.</p></blockquote><p>So to use ELI5 we will need to define our own function which takes as input a list of strings (documents) and return a matrix of shape <strong>(n_samples, n_classes).</strong> You can see how we first preprocess and then predict.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>predict_complex</span>(docs):
    <span style=color:#75715e># preprocess the docs as required by our model</span>
    val_X <span style=color:#f92672>=</span> tokenizer<span style=color:#f92672>.</span>texts_to_sequences(docs)
    val_X <span style=color:#f92672>=</span> pad_sequences(val_X, maxlen<span style=color:#f92672>=</span>maxlen)
    y_preds <span style=color:#f92672>=</span> model<span style=color:#f92672>.</span>predict([val_X], batch_size<span style=color:#f92672>=</span><span style=color:#ae81ff>1024</span>, verbose<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)
    <span style=color:#66d9ef>return</span> y_preds
</code></pre></div><p>Given below is how we can use TextExplainer. Using the same misclassified example as before in our simple classifier.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=color:#f92672>import</span> eli5
<span style=color:#f92672>from</span> eli5.lime <span style=color:#f92672>import</span> TextExplainer

te <span style=color:#f92672>=</span> TextExplainer(random_state<span style=color:#f92672>=</span><span style=color:#ae81ff>2019</span>)
te<span style=color:#f92672>.</span>fit(sodata[<span style=color:#e6db74>&#39;post&#39;</span>]<span style=color:#f92672>.</span>values[<span style=color:#ae81ff>0</span>], predict_complex)
te<span style=color:#f92672>.</span>show_prediction(target_names<span style=color:#f92672>=</span>list(encoder<span style=color:#f92672>.</span>classes_))
</code></pre></div><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset="/images/interpret/8_hu3d3e6cd9d645fc327636e35173a65972_284782_500x0_resize_box_2.png 500w
, /images/interpret/8_hu3d3e6cd9d645fc327636e35173a65972_284782_800x0_resize_box_2.png 800w
, /images/interpret/8_hu3d3e6cd9d645fc327636e35173a65972_284782_1200x0_resize_box_2.png 1200w
, /images/interpret/8_hu3d3e6cd9d645fc327636e35173a65972_284782_1500x0_resize_box_2.png 1500w" src=/images/interpret/8.png alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p>This time it doesn’t get misclassified. You can see that the presence of keywords dict and list is what is influencing the decision of our classifier. One can try to see more examples to find more insights.</p><p><em><strong>So how does this work exactly?</strong></em></p><p><a href=https://eli5.readthedocs.io/en/latest/autodocs/lime.html#eli5.lime.lime.TextExplainer target=_blank rel="nofollow noopener">&lt;strong>TextExplainer&lt;/strong></a>
generates a lot of texts similar to the document by removing some of the words, and then trains a white-box classifier which predicts the output of the black-box classifier and not the true labels. The explanation we see is for this white-box classifier.</p><p>This is, in essence, a little bit similar to the Teacher-Student model distillation, where we use a simpler model to predict outputs from a much more complex teacher model.</p><p>Put simply, it tries to create a simpler model that emulates a complex model and then shows us the simpler model weights.</p><h2 id=conclusion>Conclusion</h2><blockquote><p>Understanding is crucial. Being able to interpret our models can help us to understand our models better and in turn, explain them better.</p></blockquote><p>ELI5 provides us with a good way to do this. It works for a variety of models and the
<a href=https://eli5.readthedocs.io/en/latest/index.html target=_blank rel="nofollow noopener">documentation</a>
for this library is one of the best I have ever seen.</p><p>Also, I love the decorated output the ELI5 library provides with the simple and fast way it provides to interpret my models. And debug them too.</p><p>To use ELI5 with your models you can follow along with the code in this
<a href=https://www.kaggle.com/mlwhiz/interpreting-text-classification-models-with-eli5 target=_blank rel="nofollow noopener">Kaggle Kernel</a></p><h2 id=continue-learning>Continue Learning</h2><p>If you wantIf you want to learn more about Deep Learning, I would like to recommend this awesome
<a href=https://coursera.pxf.io/7mKnnY target=_blank rel="nofollow noopener">Deep Learning Specialization</a>
. You can start for free with the 7-day Free Trial. This specialization talks about various CNN architetures and covers a wide variety of problems in the image domain including detection and segmentation.You might also like to take a look at some of my
<a href=https://towardsdatascience.com/tagged/nlp-learning-series target=_blank rel="nofollow noopener">posts on NLP</a>
in the NLP Learning series.</p><p>Thanks for the read. I am going to be writing more beginner-friendly posts in the future too. Follow me up at
<a href="https://mlwhiz.medium.com/?source=post_page---------------------------" target=_blank rel="nofollow noopener">&lt;strong>Medium&lt;/strong></a>
or Subscribe to my
<a href=https://mlwhiz.ck.page/a9b8bda70c target=_blank rel="nofollow noopener">&lt;strong>blog&lt;/strong></a></p><p>Also, a small disclaimer — There might be some affiliate links in this post to relevant resources as sharing knowledge is never a bad idea.</p><script async data-uid=8d7942551b src=https://mlwhiz.ck.page/8d7942551b/index.js></script><div class=shareaholic-canvas data-app=share_buttons data-app-id=28372088 style=margin-bottom:1px></div><a href=https://coursera.pxf.io/coursera rel=nofollow><img border=0 alt="Start your future with a Data Analysis Certificate." src="https://ad.linksynergy.com/fs-bin/show?id=lVarvwc5BD0&bids=759505.377&subid=0&type=4&gridnum=16"></a><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"mlwhiz"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div class=col-lg-4><div class=widget><script type=text/javascript src=https://ko-fi.com/widgets/widget_2.js></script><script type=text/javascript>kofiwidget2.init('Support Me on Ko-fi','#00aaa1','S6S3NPCD');kofiwidget2.draw();</script></div><div class=widget><h4 class=widget-title>About Me</h4><img src=https://mlwhiz.com/images/author.jpg alt class="img-fluid author-thumb-sm d-block mx-auto rounded-circle mb-4"><p>I’m a data scientist consultant and big data engineer based in London, where I am currently working with Facebook .</p><a href=https://mlwhiz.com/about/ class="btn btn-outline-primary">Know More</a></div><div class=widget><h4 class=widget-title>Topics</h4><ul class=list-unstyled><li><a class=categoryStyle style=color:#fff href=/categories/awesome-guides>Awesome Guides</a></li><li><a class=categoryStyle style=color:#fff href=/categories/big-data>Big Data</a></li><li><a class=categoryStyle style=color:#fff href=/categories/computer-vision>Computer Vision</a></li><li><a class=categoryStyle style=color:#fff href=/categories/data-science>Data Science</a></li><li><a class=categoryStyle style=color:#fff href=/categories/deep-learning>Deep Learning</a></li><li><a class=categoryStyle style=color:#fff href=/categories/learning-resources>Learning Resources</a></li><li><a class=categoryStyle style=color:#fff href=/categories/natural-language-processing>Natural Language Processing</a></li><li><a class=categoryStyle style=color:#fff href=/categories/programming>Programming</a></li></ul></div><div class=widget><h4 class=widget-title>Tags</h4><ul class=list-inline><li class=list-inline-item><a class="tagStyle text-white" href=/tags/algorithms>Algorithms</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/artificial-intelligence>Artificial Intelligence</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/dask>Dask</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/deployment>Deployment</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/ec2>Ec2</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/generative-adversarial-networks>Generative Adversarial Networks</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/graphs>Graphs</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/image-classification>Image Classification</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/instance-segmentation>Instance Segmentation</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/interpretability>Interpretability</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/jobs>Jobs</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/kaggle>Kaggle</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/language-modeling>Language Modeling</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/machine-learning>Machine Learning</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/math>Math</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/multiprocessing>Multiprocessing</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/object-detection>Object Detection</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/oop>Oop</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/opinion>Opinion</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/pandas>Pandas</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/production>Production</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/productivity>Productivity</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/python>Python</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/pytorch>Pytorch</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/spark>Spark</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/sql>Sql</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/statistics>Statistics</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/streamlit>Streamlit</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/text-classification>Text Classification</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/timeseries>Timeseries</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/tools>Tools</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/transformers>Transformers</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/translation>Translation</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/visualization>Visualization</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/xgboost>Xgboost</a></li></ul></div><div class=widget><h4 class=widget-title>Connect With Me</h4><ul class="list-inline social-links"><li class=list-inline-item><a href=https://www.linkedin.com/in/rahulagwl/><i class=ti-linkedin></i></a></li><li class=list-inline-item><a href=https://mlwhiz.medium.com/><i class=ti-book></i></a></li><li class=list-inline-item><a href=https://twitter.com/MLWhiz><i class=ti-twitter-alt></i></a></li><li class=list-inline-item><a href=https://www.facebook.com/mlwhizblog><i class=ti-facebook></i></a></li><li class=list-inline-item><a href=https://github.com/MLWhiz><i class=ti-github></i></a></li></ul></div><script async data-uid=bfe9f82f10 src=https://mlwhiz.ck.page/bfe9f82f10/index.js></script><script async data-uid=3452d924e2 src=https://mlwhiz.ck.page/3452d924e2/index.js></script></div></div></div></section><footer><div class=container><div class=row><div class="col-12 text-center mb-5"><a href=https://mlwhiz.com/><img src=https://mlwhiz.com/images/logo.png class=img-fluid-custom-bottom alt="Helping You Learn Data Science!"></a></div><div class="col-lg-3 col-sm-6 mb-5"><h6 class=mb-4>Contact Me</h6><ul class=list-unstyled><li class=mb-3><i class="ti-location-pin mr-3 text-primary"></i>India, Bangalore</li><li class=mb-3><a class=text-dark href=mailto:rahul@mlwhiz.com><i class="ti-email mr-3 text-primary"></i>rahul@mlwhiz.com</a></li></ul></div><div class="col-lg-3 col-sm-6 mb-5"><h6 class=mb-4>Social Contacts</h6><ul class=list-unstyled><li class=mb-3><a class=text-dark href=https://www.linkedin.com/in/rahulagwl/>Linkedin</a></li><li class=mb-3><a class=text-dark href=https://mlwhiz.medium.com/>Medium</a></li><li class=mb-3><a class=text-dark href=https://twitter.com/MLWhiz>Twitter</a></li><li class=mb-3><a class=text-dark href=https://www.facebook.com/mlwhizblog>Facebook</a></li><li class=mb-3><a class=text-dark href=https://github.com/MLWhiz>Github</a></li></ul></div><div class="col-lg-3 col-sm-6 mb-5"><h6 class=mb-4>Categories</h6><ul class=list-unstyled><li class=mb-3><a class=text-dark href=/categories/awesome-guides>Awesome Guides</a></li><li class=mb-3><a class=text-dark href=/categories/big-data>Big Data</a></li><li class=mb-3><a class=text-dark href=/categories/computer-vision>Computer Vision</a></li><li class=mb-3><a class=text-dark href=/categories/data-science>Data Science</a></li><li class=mb-3><a class=text-dark href=/categories/deep-learning>Deep Learning</a></li><li class=mb-3><a class=text-dark href=/categories/learning-resources>Learning Resources</a></li><li class=mb-3><a class=text-dark href=/categories/natural-language-processing>Natural Language Processing</a></li><li class=mb-3><a class=text-dark href=/categories/programming>Programming</a></li></ul></div><div class="col-lg-3 col-sm-6 mb-5"><h6 class=mb-4>Quick Links</h6><ul class=list-unstyled><li class=mb-3><a class=text-dark href=https://mlwhiz.com/about>About</a></li><li class=mb-3><a class=text-dark href=https://mlwhiz.com/blog>Post</a></li></ul></div><div class="col-12 border-top py-4 text-center">Copyright © 2020 <a href=https://mlwhiz.com>MLWhiz</a> All Rights Reserved</div></div></div></footer><script>var indexURL="https://mlwhiz.com/index.json"</script><script src=https://mlwhiz.com/plugins/compressjscss/main.js></script><script src=https://mlwhiz.com/js/script.min.js></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-54777926-1','auto');ga('send','pageview');</script></body></html>