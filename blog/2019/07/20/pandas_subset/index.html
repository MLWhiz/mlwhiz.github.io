<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Minimal Pandas Subset for Data Scientists</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="There are multiple ways to doing the same thing in Pandas, and that might make it troublesome for the beginner user.This post is about handling most of the data manipulation cases in Python using a straightforward, simple, and matter of fact way.">
	

	
	<link rel='preload' href='//apps.shareaholic.com/assets/pub/shareaholic.js' as='script' />
	<script type="text/javascript" data-cfasync="false" async src="//apps.shareaholic.com/assets/pub/shareaholic.js" data-shr-siteid="fd1ffa7fd7152e4e20568fbe49a489d0"></script>
	
	
	<meta name="generator" content="Hugo 0.53" />
	<meta property="og:title" content="Minimal Pandas Subset for Data Scientists" />
<meta property="og:description" content="There are multiple ways to doing the same thing in Pandas, and that might make it troublesome for the beginner user.This post is about handling most of the data manipulation cases in Python using a straightforward, simple, and matter of fact way." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mlwhiz.com/blog/2019/07/20/pandas_subset/" />
<meta property="og:image" content="https://mlwhiz.com/images/pandas_subset/1.jpeg" />
<meta property="article:published_time" content="2019-07-20T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2019-07-20T00:00:00&#43;00:00"/>

	<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://mlwhiz.com/images/pandas_subset/1.jpeg"/>

<meta name="twitter:title" content="Minimal Pandas Subset for Data Scientists"/>
<meta name="twitter:description" content="There are multiple ways to doing the same thing in Pandas, and that might make it troublesome for the beginner user.This post is about handling most of the data manipulation cases in Python using a straightforward, simple, and matter of fact way."/>


	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/custom.css">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	
	
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-54777926-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

	
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-NMQD44T');</script>
	

	
	<script>
	  !function(f,b,e,v,n,t,s)
	  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
	  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
	  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
	  n.queue=[];t=b.createElement(e);t.async=!0;
	  t.src=v;s=b.getElementsByTagName(e)[0];
	  s.parentNode.insertBefore(t,s)}(window, document,'script',
	  'https://connect.facebook.net/en_US/fbevents.js');
	  fbq('init', '1062344757288542');
	  fbq('track', 'PageView');
	</script>
	<noscript><img height="1" width="1" style="display:none"
	  src="https://www.facebook.com/tr?id=1062344757288542&ev=PageView&noscript=1"
	/></noscript>
	


	
  	<script async>(function(s,u,m,o,j,v){j=u.createElement(m);v=u.getElementsByTagName(m)[0];j.async=1;j.src=o;j.dataset.sumoSiteId='22863fd8ad7ebbfab9b8ca60b7db8f65e9a15559f384f785f66903e365aa8f48';v.parentNode.insertBefore(j,v)})(window,document,'script','//load.sumo.com/');</script>
  	<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
  });
  MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });

  MathJax.Hub.Config({
  
  TeX: { equationNumbers: { autoNumber: "AMS" } }
  });
</script>
</head>
<body class="body">
	  
	  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NMQD44T"
	  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	  
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">

			<a class="logo__link" href="/" title="MLWhiz" rel="home">

				<div class="logo__title">MLWhiz</div>
				<div class="logo__tagline">Deep Learning, Data Science and NLP Enthusiast</div>
			</a>
		</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">Blog</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/archive">Archive</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about/">About Me</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/nlpseries/">NLP</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/atom.xml">RSS</a>
		</li>
	</ul>
</nav>

	</div>
</header>


		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Minimal Pandas Subset for Data Scientists</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg>
	<time class="meta__text" datetime="2019-07-20T00:00:00">July 20, 2019</time>
</div>
</div>
		</header>
		<div class="content post__content clearfix">
			

<div style="margin-top: 9px; margin-bottom: 10px;">
<center><img src="/images/pandas_subset/1.jpeg" "></center>
</div>

<p>Pandas is a vast library.</p>

<p>Data manipulation is a breeze with pandas, and it has become such a standard for it that a lot of parallelization libraries like Rapids and Dask are being created in line with Pandas syntax.</p>

<p>Still, I generally have some issues with it.</p>

<p><strong><em>There are multiple ways to doing the same thing in Pandas, and that might make it troublesome for the beginner user.</em></strong></p>

<p>This has inspired me to come up with a minimal subset of pandas functions I use while coding.</p>

<p>I have tried it all, and currently, I stick to a particular way. It is like a mind map.</p>

<p><strong><em>Sometimes because it is fast and sometimes because it’s more readable and sometimes because I can do it with my current knowledge. And sometimes because I know that a particular way will be a headache in the long run(think multi-index)</em></strong></p>

<p><strong><em>This post is about handling most of the data manipulation cases in Python using a straightforward, simple, and matter of fact way.</em></strong></p>

<p>With a sprinkling of some recommendations throughout.</p>

<p>I will be using a data set of 1,000 popular movies on IMDB in the last ten years. You can also follow along in the <a href="https://www.kaggle.com/mlwhiz/minimal-pandas-subset" rel="nofollow" target="_blank">Kaggle Kernel</a>.</p>

<hr />

<h2 id="some-default-pandas-requirements">Some Default Pandas Requirements</h2>

<p><img src="/images/pandas_subset/2.png" alt="" /></p>

<p>As good as the Jupyter notebooks are, some things still need to be specified when working with Pandas.</p>

<p>***Sometimes your notebook won’t show you all the columns. Sometimes it will display all the rows if you print the dataframe. ***You can control this behavior by setting some defaults of your own while importing Pandas. You can automate it using <a href="https://towardsdatascience.com/three-great-additions-for-your-jupyter-notebooks-cd7373b00e96" rel="nofollow" target="_blank">this addition</a> to your notebook.</p>

<p>For instance, this is the setting I use.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#75715e"># pandas defaults</span>
pd<span style="color:#f92672">.</span>options<span style="color:#f92672">.</span>display<span style="color:#f92672">.</span>max_columns <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>
pd<span style="color:#f92672">.</span>options<span style="color:#f92672">.</span>display<span style="color:#f92672">.</span>max_rows <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span></code></pre></div>
<hr />

<h2 id="reading-data-with-pandas">Reading Data with Pandas</h2>

<p><img src="/images/pandas_subset/3.jpg" alt="" /></p>

<p>The first thing we do is reading the data source and so here is the code for that.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#34;IMDB-Movie-Data.csv&#34;</span>)</code></pre></div>
<p><strong><em>Recommendation:</em></strong> I could also have used pd.read_table to read the file. The thing is that pd.read_csv has default separator as , and thus it saves me some code. I also genuinely don’t understand the use of pd.read_table</p>

<p>If your data is in some SQL Datasource, you could have used the following code. You get the results in the dataframe format.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#75715e"># Reading from SQL Datasource</span>
<span style="color:#f92672">import</span> MySQLdb
<span style="color:#f92672">from</span> pandas <span style="color:#f92672">import</span> DataFrame
<span style="color:#f92672">from</span> pandas.io.sql <span style="color:#f92672">import</span> read_sql

db <span style="color:#f92672">=</span> MySQLdb<span style="color:#f92672">.</span>connect(host<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;localhost&#34;</span>,    <span style="color:#75715e"># your host, usually localhost</span>
                     user<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;root&#34;</span>,         <span style="color:#75715e"># your username</span>
                     passwd<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;password&#34;</span>,   <span style="color:#75715e"># your password</span>
                     db<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dbname&#34;</span>)         <span style="color:#75715e"># name of the data base</span>

query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SELECT * FROM tablename&#34;</span>

df <span style="color:#f92672">=</span> read_sql(query, db)</code></pre></div>
<hr />

<h2 id="data-snapshot">Data Snapshot</h2>

<p><img src="/images/pandas_subset/4.jpg" alt="" /></p>

<p>Always useful to see some of the data.</p>

<p>You can use simple head and tail commands with an option to specify the number of rows.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#75715e"># top 5 rows</span>
df<span style="color:#f92672">.</span>head()

<span style="color:#75715e"># top 50 rows</span>
df<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">50</span>)

<span style="color:#75715e"># last 5 rows</span>
df<span style="color:#f92672">.</span>tail()

<span style="color:#75715e"># last 50 rows</span>
df<span style="color:#f92672">.</span>tail(<span style="color:#ae81ff">50</span>)</code></pre></div>
<p>You can also see simple dataframe statistics with the following commands.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#75715e"># To get statistics of numerical columns</span>
df<span style="color:#f92672">.</span>describe()</code></pre></div>
<p><img src="/images/pandas_subset/4a.png" alt="" /></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#75715e"># To get maximum value of a column. When you take a single column you can think of it as a list and apply functions you would apply to a list. You can also use min for instance.</span>

<span style="color:#66d9ef">print</span>(max(df[<span style="color:#e6db74">&#39;rating&#39;</span>]))

<span style="color:#75715e"># no of rows in dataframe</span>
<span style="color:#66d9ef">print</span>(len(df))

<span style="color:#75715e"># Shape of Dataframe</span>
<span style="color:#66d9ef">print</span>(df<span style="color:#f92672">.</span>shape)</code></pre></div>
<pre><code>9.0
1000
(1000,12)
</code></pre>

<p><strong><em>Recommendation:</em></strong> Generally working with Jupyter notebook,<strong><em>I make it a point of having the first few cells in my notebook containing these snapshots</em></strong> of the data. This helps me see the structure of the data whenever I want to. If I don’t follow this practice, I notice that I end up repeating the <code>.head()</code> command a lot of times in my code.</p>

<hr />

<h2 id="handling-columns-in-dataframes">Handling Columns in Dataframes</h2>

<p><img src="/images/pandas_subset/5.jpg" alt="" /></p>

<h3 id="a-selecting-a-column">a. Selecting a column</h3>

<p>For some reason Pandas lets you choose columns in two ways. Using the dot operator like <code>df.Title</code> and using square brackets like <code>df['Title']</code></p>

<p>I prefer the second version, mostly. Why?</p>

<p>There are a couple of reasons you would be better off with the square bracket version in the longer run.</p>

<ul>
<li><p>If your column name contains spaces, then the dot version won’t work. For example, <code>df.Revenue (Millions)</code> won’t work while <code>df['Revenue (Millions)']</code> will.</p></li>

<li><p>It also won’t work if your column name is <code>count</code> or <code>mean</code> or any of pandas predefined functions.</p></li>

<li><p>Sometimes you might need to create a for loop over your column names in which your column name might be in a variable. In that case, the dot notation will not work. For Example, This works:</p></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">colname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;height&#39;</span>
df[colname]</code></pre></div>
<p>While this doesn’t:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">colname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;height&#39;</span>
df<span style="color:#f92672">.</span>colname</code></pre></div>
<p>Trust me. Saving a few characters is not worth it.</p>

<p><strong><em>Recommendation: Stop using the dot operator</em></strong>. It is a construct that originated from a different language&reg; and respectfully should be left there.</p>

<h3 id="b-getting-column-names-in-a-list">b. Getting Column Names in a list</h3>

<p>You might need a list of columns for some later processing.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">columnnames <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>columns</code></pre></div>
<h3 id="c-specifying-user-defined-column-names">c. Specifying user-defined Column Names:</h3>

<p>Sometimes you want to change the column names as per your taste. I don’t like spaces in my column names, so I change them as such.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">df<span style="color:#f92672">.</span>columns <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;Rank&#39;</span>, <span style="color:#e6db74">&#39;Title&#39;</span>, <span style="color:#e6db74">&#39;Genre&#39;</span>, <span style="color:#e6db74">&#39;Description&#39;</span>, <span style="color:#e6db74">&#39;Director&#39;</span>, <span style="color:#e6db74">&#39;Actors&#39;</span>, <span style="color:#e6db74">&#39;Year&#39;</span>,
       <span style="color:#e6db74">&#39;Runtime_Minutes&#39;</span>, <span style="color:#e6db74">&#39;Rating&#39;</span>, <span style="color:#e6db74">&#39;Votes&#39;</span>, <span style="color:#e6db74">&#39;Revenue_Millions&#39;</span>,
       <span style="color:#e6db74">&#39;Metascore&#39;</span>]</code></pre></div>
<p>I could have used another way.</p>

<p>This is the one case where both of the versions are important. When I have to change a lot of column names, I go with the way above. When I have to change the name of just one or two columns I use:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">df<span style="color:#f92672">.</span>rename(columns <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;Revenue (Millions)&#39;</span>:<span style="color:#e6db74">&#39;Rev_M&#39;</span>,<span style="color:#e6db74">&#39;Runtime (Minutes)&#39;</span>:<span style="color:#e6db74">&#39;Runtime_min&#39;</span>},inplace<span style="color:#f92672">=</span>True)</code></pre></div>
<h3 id="d-subsetting-specific-columns">d. Subsetting specific columns:</h3>

<p>Sometimes you only need to work with particular columns in a dataframe. e.g., to separate numerical and categorical columns, or remove unnecessary columns. Let’s say in our example; we don’t need the description, director, and actor column.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">df <span style="color:#f92672">=</span> df[[<span style="color:#e6db74">&#39;Rank&#39;</span>, <span style="color:#e6db74">&#39;Title&#39;</span>, <span style="color:#e6db74">&#39;Genre&#39;</span>, <span style="color:#e6db74">&#39;Year&#39;</span>,<span style="color:#e6db74">&#39;Runtime_min&#39;</span>, <span style="color:#e6db74">&#39;Rating&#39;</span>, <span style="color:#e6db74">&#39;Votes&#39;</span>, <span style="color:#e6db74">&#39;Rev_M&#39;</span>, <span style="color:#e6db74">&#39;Metascore&#39;</span>]]</code></pre></div>
<h3 id="e-seeing-column-types">e. Seeing column types:</h3>

<p>Very useful while debugging. If your code throws an error that you cannot add a str and int, you will like to run this command.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">df<span style="color:#f92672">.</span>dtypes</code></pre></div>
<hr />

<h2 id="applying-functions-on-dataframe-apply-and-lambda">Applying Functions on DataFrame: Apply and Lambda</h2>

<p><img src="/images/pandas_subset/6.png" alt="" /></p>

<p><code>apply</code> and <code>lambda</code> are some of the best things I have learned to use with pandas.</p>

<p>I use <code>apply</code> and <code>lambda</code> anytime I get stuck while building a complex logic for a new column or filter.</p>

<h3 id="a-creating-a-column">a. Creating a Column</h3>

<p>You can create a new column in many ways.</p>

<p>If you want a column that is a sum or difference of columns, you can pretty much use simple basic arithmetic. Here I get the average rating based on IMDB and Normalized Metascore.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">df[<span style="color:#e6db74">&#39;AvgRating&#39;</span>] <span style="color:#f92672">=</span> (df[<span style="color:#e6db74">&#39;Rating&#39;</span>] <span style="color:#f92672">+</span> df[<span style="color:#e6db74">&#39;Metascore&#39;</span>]<span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>)<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span></code></pre></div>
<p>But sometimes we may need to build complex logic around the creation of new columns.</p>

<p>To give you a convoluted example, let’s say that we want to build a custom movie score based on a variety of factors.</p>

<p><strong><em>Say, If the movie is of the thriller genre, I want to add 1 to the IMDB rating subject to the condition that IMDB rating remains less than or equal to 10. And If a movie is a comedy I want to subtract one from the rating.</em></strong></p>

<p><strong><em>How do we do that?</em></strong></p>

<p>Whenever I get a hold of such complex problems, I use <code>apply/lambda</code>. Let me first show you how I will do this.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">custom_rating</span>(genre,rating):
    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;Thriller&#39;</span> <span style="color:#f92672">in</span> genre:
        <span style="color:#66d9ef">return</span> min(<span style="color:#ae81ff">10</span>,rating<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
    <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#39;Comedy&#39;</span> <span style="color:#f92672">in</span> genre:
        <span style="color:#66d9ef">return</span> max(<span style="color:#ae81ff">0</span>,rating<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
    <span style="color:#66d9ef">else</span>:
        <span style="color:#66d9ef">return</span> rating
        
df[<span style="color:#e6db74">&#39;CustomRating&#39;</span>] <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: custom_rating(x[<span style="color:#e6db74">&#39;Genre&#39;</span>],x[<span style="color:#e6db74">&#39;Rating&#39;</span>]),axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)</code></pre></div>
<p>The general structure is:</p>

<ul>
<li><p>You define a function that will take the column values you want to play with to come up with your logic. Here the only two columns we end up using are genre and rating.</p></li>

<li><p>You use an apply function with lambda along the row with axis=1. The general syntax is:</p></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">df<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: func(x[<span style="color:#e6db74">&#39;col1&#39;</span>],x[<span style="color:#e6db74">&#39;col2&#39;</span>]),axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)</code></pre></div>
<p>You should be able to create pretty much any logic using apply/lambda since you just have to worry about the custom function.</p>

<h3 id="b-filtering-a-dataframe">b. Filtering a dataframe</h3>

<p><img src="/images/pandas_subset/7.jpeg" alt="" /></p>

<p>Pandas make filtering and subsetting dataframes pretty easy. You can filter and subset dataframes using normal operators and <code>&amp;,|,~</code> operators.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#75715e"># Single condition: dataframe with all movies rated greater than 8</span>

df_gt_8 <span style="color:#f92672">=</span> df[df[<span style="color:#e6db74">&#39;Rating&#39;</span>]<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">8</span>]

<span style="color:#75715e"># Multiple conditions: AND - dataframe with all movies rated greater than 8 and having more than 100000 votes</span>

And_df <span style="color:#f92672">=</span> df[(df[<span style="color:#e6db74">&#39;Rating&#39;</span>]<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">8</span>) <span style="color:#f92672">&amp;</span> (df[<span style="color:#e6db74">&#39;Votes&#39;</span>]<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">100000</span>)]

<span style="color:#75715e"># Multiple conditions: OR - dataframe with all movies rated greater than 8 or having a metascore more than 90</span>

Or_df <span style="color:#f92672">=</span> df[(df[<span style="color:#e6db74">&#39;Rating&#39;</span>]<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">8</span>) <span style="color:#f92672">|</span> (df[<span style="color:#e6db74">&#39;Metascore&#39;</span>]<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">80</span>)]

<span style="color:#75715e"># Multiple conditions: NOT - dataframe with all emovies rated greater than 8 or having a metascore more than 90 have to be excluded</span>

Not_df <span style="color:#f92672">=</span> df[<span style="color:#f92672">~</span>((df[<span style="color:#e6db74">&#39;Rating&#39;</span>]<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">8</span>) <span style="color:#f92672">|</span> (df[<span style="color:#e6db74">&#39;Metascore&#39;</span>]<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">80</span>))]</code></pre></div>
<p>Pretty simple stuff.</p>

<p>But sometimes we may need to do complex filtering operations.</p>

<p>And sometimes we need to do some operations which we won’t be able to do using just the above format.</p>

<p>For instance: Let us say <strong><em>we want to filter those rows where the number of words in the movie title is greater than or equal to than 4.</em></strong></p>

<p><strong><em>How would you do it?</em></strong></p>

<p>Trying the below will give you an error. Apparently, you cannot do anything as simple as split with a series.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">new_df <span style="color:#f92672">=</span> df[len(df[<span style="color:#e6db74">&#39;Title&#39;</span>]<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34; &#34;</span>))<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">4</span>]</code></pre></div>
<pre><code>AttributeError: 'Series' object has no attribute 'split'
</code></pre>

<p>One way is first to create a column which contains no of words in the title using apply and then filter on that column.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#75715e">#create a new column</span>
df[<span style="color:#e6db74">&#39;num_words_title&#39;</span>] <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x : len(x[<span style="color:#e6db74">&#39;Title&#39;</span>]<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34; &#34;</span>)),axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)

<span style="color:#75715e">#simple filter on new column</span>
new_df <span style="color:#f92672">=</span> df[df[<span style="color:#e6db74">&#39;num_words_title&#39;</span>]<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">4</span>]</code></pre></div>
<p>And that is a perfectly fine way as long as you don’t have to create a lot of columns. But I prefer this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">new_df <span style="color:#f92672">=</span> df[df<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x : len(x[<span style="color:#e6db74">&#39;Title&#39;</span>]<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34; &#34;</span>))<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">4</span>,axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)]</code></pre></div>
<p>What I did here is that <strong><em>my apply function returns a boolean which can be used to filter.</em></strong></p>

<p>Now once you understand that you just have to create a column of booleans to filter, you can use any function/logic in your apply statement to get however complex a logic you want to build.</p>

<p>Let us see another example. I will try to do something a little complex to show the structure.</p>

<p><strong><em>We want to find movies for which the revenue is less than the average revenue for that particular year?</em></strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">year_revenue_dict <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>groupby([<span style="color:#e6db74">&#39;Year&#39;</span>])<span style="color:#f92672">.</span>agg({<span style="color:#e6db74">&#39;Rev_M&#39;</span>:np<span style="color:#f92672">.</span>mean})<span style="color:#f92672">.</span>to_dict()[<span style="color:#e6db74">&#39;Rev_M&#39;</span>]

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">bool_provider</span>(revenue, year):
    <span style="color:#66d9ef">return</span> revenue<span style="color:#f92672">&lt;</span>year_revenue_dict[year]
    
new_df <span style="color:#f92672">=</span> df[df<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x : bool_provider(x[<span style="color:#e6db74">&#39;Rev_M&#39;</span>],x[<span style="color:#e6db74">&#39;Year&#39;</span>]),axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)]</code></pre></div>
<p>We have a function here which we can use to write any logic. That provides a lot of power for advanced filtering as long as we can play with simple variables.</p>

<h3 id="c-change-column-types">c. Change Column Types</h3>

<p>I even use apply to change the column types since I don’t want to remember the syntax for changing column type and also since it lets me do much more complicated things.</p>

<p>The usual syntax to change column type is astype in Pandas. So if I had a column named price in my data in an str format. I could do this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">df[<span style="color:#e6db74">&#39;Price&#39;</span>] <span style="color:#f92672">=</span> newDf[<span style="color:#e6db74">&#39;Price&#39;</span>]<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;int&#39;</span>)</code></pre></div>
<p>But sometimes it won’t work as expected.</p>

<p>You might get the error: <code>ValueError: invalid literal for long() with base 10: ‘13,000’</code>. That is you cannot cast a string with “,” to an int. To do that we first have to get rid of the comma.</p>

<p>After facing this problem time and again, I have stopped using astype altogether now and just use apply to change column types.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">df[<span style="color:#e6db74">&#39;Price&#39;</span>] <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: int(x[<span style="color:#e6db74">&#39;Price&#39;</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;,&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>)),axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)</code></pre></div>
<h3 id="and-lastly-there-is-progress-apply">And lastly, there is progress_apply</h3>

<p><img src="/images/pandas_subset/8.png" alt="" /></p>

<p><code>progress_apply</code> is a function that comes with <code>tqdm</code> package.</p>

<p>And this has saved me a lot of time.</p>

<p>Sometimes when you have got a lot of rows in your data, or you end up writing a pretty complex apply function, you will see that apply might take a lot of time.</p>

<p>I have seen apply taking hours when working with Spacy. In such cases, you might like to see the progress bar with <code>apply</code>.</p>

<p>You can use <code>tqdm</code> for that.</p>

<p>After the initial imports at the top of your notebook, just replace <code>apply</code> with <code>progress_apply</code> and everything remains the same.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#f92672">from</span> tqdm <span style="color:#f92672">import</span> tqdm, tqdm_notebook
tqdm_notebook()<span style="color:#f92672">.</span>pandas()

df<span style="color:#f92672">.</span>progress_apply(<span style="color:#66d9ef">lambda</span> x: custom_rating_function(x[<span style="color:#e6db74">&#39;Genre&#39;</span>],x[<span style="color:#e6db74">&#39;Rating&#39;</span>]),axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)</code></pre></div>
<p>And you get progress bars.</p>

<p><img src="/images/pandas_subset/9.png" alt="" /></p>

<p><strong><em>Recommendation:</em></strong>vWhenever you see that you have to create a column with custom complex logic, think of apply and lambda. Try using progress_apply too.</p>

<hr />

<h2 id="aggregation-on-dataframes-groupby">Aggregation on Dataframes: groupby</h2>

<p><img src="/images/pandas_subset/10.jpg" alt="" /></p>

<p>groupby will come up a lot of times whenever you want to aggregate your data. Pandas lets you do this efficiently with the groupby function.</p>

<p>There are a lot of ways that you can use groupby. I have seen a lot of versions, but I prefer a particular style since I feel the version I use is easy, intuitive, and scalable for different use cases.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">df<span style="color:#f92672">.</span>groupby(list of columns to groupby on)<span style="color:#f92672">.</span>aggregate({<span style="color:#e6db74">&#39;colname&#39;</span>:func1, <span style="color:#e6db74">&#39;colname2&#39;</span>:func2})<span style="color:#f92672">.</span>reset_index()</code></pre></div>
<p>Now you see it is pretty simple. You just have to worry about supplying two primary pieces of information.</p>

<ul>
<li><p>List of columns to groupby on, and</p></li>

<li><p>A dictionary of columns and functions you want to apply to those columns</p></li>
</ul>

<p>reset_index() is a function that resets the index of a dataframe. I apply this function ALWAYS whenever I do a groupby, and you might think of it as a default syntax for groupby operations.</p>

<p>Let us check out an example.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#75715e"># Find out the sum of votes and revenue by year</span>

<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
df<span style="color:#f92672">.</span>groupby([<span style="color:#e6db74">&#39;Year&#39;</span>])<span style="color:#f92672">.</span>aggregate({<span style="color:#e6db74">&#39;Votes&#39;</span>:np<span style="color:#f92672">.</span>sum, <span style="color:#e6db74">&#39;Rev_M&#39;</span>:np<span style="color:#f92672">.</span>sum})<span style="color:#f92672">.</span>reset_index()</code></pre></div>
<p><img src="/images/pandas_subset/11.png" alt="" /></p>

<p>You might also want to group by more than one column. It is fairly straightforward.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">df<span style="color:#f92672">.</span>groupby([<span style="color:#e6db74">&#39;Year&#39;</span>,<span style="color:#e6db74">&#39;Genre&#39;</span>])<span style="color:#f92672">.</span>aggregate({<span style="color:#e6db74">&#39;Votes&#39;</span>:np<span style="color:#f92672">.</span>sum, <span style="color:#e6db74">&#39;Rev_M&#39;</span>:np<span style="color:#f92672">.</span>sum})<span style="color:#f92672">.</span>reset_index()</code></pre></div>
<p><img src="/images/pandas_subset/12.png" alt="" /></p>

<p><strong><em>Recommendation:</em></strong> Stick to one syntax for groupby. Pick your own if you don’t like mine but stick to one.</p>

<hr />

<h2 id="dealing-with-multiple-dataframes-concat-and-merge">Dealing with Multiple Dataframes: Concat and Merge:</h2>

<p><img src="/images/pandas_subset/13.jpeg" alt="" /></p>

<h3 id="a-concat">a. concat</h3>

<p>Sometimes we get data from different sources. Or someone comes to you with multiple files with each file having data for a particular year.</p>

<p><strong><em>How do we create a single dataframe from a single dataframe?</em></strong></p>

<p>Here we will create our use case artificially since we just have a single file. We are creating two dataframes first using the basic filter operations we already know.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">movies_2006 <span style="color:#f92672">=</span> df[df[<span style="color:#e6db74">&#39;Year&#39;</span>]<span style="color:#f92672">==</span><span style="color:#ae81ff">2006</span>]
movies_2007 <span style="color:#f92672">=</span> df[df[<span style="color:#e6db74">&#39;Year&#39;</span>]<span style="color:#f92672">==</span><span style="color:#ae81ff">2007</span>]</code></pre></div>
<p>Here we start with two dataframes: <code>movies_2006</code> containing info for movies released in 2006 and <code>movies_2007</code> containing info for movies released in 2007. We want to create a single dataframe that includes movies from both 2006 and 2007</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">movies_06_07 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([movies_2006,movies_2007])</code></pre></div>
<h3 id="b-merge">b. merge</h3>

<p>Most of the data that you will encounter will never come in a single file. One of the files might contain ratings for a particular movie, and another might provide the number of votes for a movie.</p>

<p>In such a case we have two dataframes which need to be merged so that we can have all the information in a single view.</p>

<p>Here we will create our use case artificially since we just have a single file. We are creating two dataframes first using the basic column subset operations we already know.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">rating_dataframe <span style="color:#f92672">=</span> df[[<span style="color:#e6db74">&#39;Title&#39;</span>,<span style="color:#e6db74">&#39;Rating&#39;</span>]]
votes_dataframe <span style="color:#f92672">=</span>  df[[<span style="color:#e6db74">&#39;Title&#39;</span>,<span style="color:#e6db74">&#39;Votes&#39;</span>]]</code></pre></div>
<p><img src="/images/pandas_subset/14.png" alt="" /></p>

<p>We need to have all this information in a single dataframe. How do we do this?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">rating_vote_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>merge(rating_dataframe,votes_dataframe,on<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Title&#39;</span>,how<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;left&#39;</span>)

rating_vote_df<span style="color:#f92672">.</span>head()</code></pre></div>
<p><img src="/images/pandas_subset/15.png" alt="" /></p>

<p>We provide this merge function with four attributes- 1st DF, 2nd DF, join on which column and the joining criteria:<code>['left','right','inner','outer']</code></p>

<p><strong><em>Recommendation:</em></strong> I usually always end up using left join. You will rarely need to join using outer or right. Actually whenever you need to do a right join you actually just really need a left join with the order of dataframes reversed in the merge function.</p>

<hr />

<h2 id="reshaping-dataframes-melt-and-pivot-table-reversemelt">Reshaping Dataframes: Melt and pivot_table(reverseMelt)</h2>

<p><img src="/images/pandas_subset/16.jpeg" alt="" /></p>

<p>Most of the time, we don’t get data in the exact form we want.</p>

<p>For example, sometimes we might have data in columns which we might need in rows.</p>

<p>Let us create an artificial example again. You can look at the code below that I use to create the example, but really it doesn’t matter.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">genre_set <span style="color:#f92672">=</span> set()
<span style="color:#66d9ef">for</span> genre <span style="color:#f92672">in</span> df[<span style="color:#e6db74">&#39;Genre&#39;</span>]<span style="color:#f92672">.</span>unique():
    <span style="color:#66d9ef">for</span> g <span style="color:#f92672">in</span> genre<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;,&#34;</span>):
        genre_set<span style="color:#f92672">.</span>add(g)
<span style="color:#66d9ef">for</span> genre <span style="color:#f92672">in</span> genre_set:
    df[genre] <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#39;Genre&#39;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">if</span> genre <span style="color:#f92672">in</span> x <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>)

working_df <span style="color:#f92672">=</span> df[[<span style="color:#e6db74">&#39;Title&#39;</span>,<span style="color:#e6db74">&#39;Rating&#39;</span>, <span style="color:#e6db74">&#39;Votes&#39;</span>,
       <span style="color:#e6db74">&#39;Rev_M&#39;</span>]<span style="color:#f92672">+</span>list(genre_set)]

working_df<span style="color:#f92672">.</span>head()</code></pre></div>
<p>So we start from a <code>working_df</code> like this:</p>

<p><img src="/images/pandas_subset/17.png" alt="" /></p>

<p>Now, this is not particularly a great structure to have data in. We might like it better if we had a dataframe with only one column Genre and we can have multiple rows repeated for the same movie. So the movie ‘Prometheus’ might be having three rows since it has three genres. How do we make that work?</p>

<p>We use <code>melt</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">reshaped_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>melt(working_df,id_vars <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;Title&#39;</span>,<span style="color:#e6db74">&#39;Rating&#39;</span>,<span style="color:#e6db74">&#39;Votes&#39;</span>,<span style="color:#e6db74">&#39;Rev_M&#39;</span>],value_vars <span style="color:#f92672">=</span> list(genre_set),var_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Genre&#39;</span>, value_name <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Flag&#39;</span>)

reshaped_df<span style="color:#f92672">.</span>head()</code></pre></div>
<p><img src="/images/pandas_subset/18.png" alt="" /></p>

<p>So in this melt function, we provided five attributes:</p>

<ul>
<li><p>dataframe_name = working_df</p></li>

<li><p>id_vars: List of vars we want in the current form only.</p></li>

<li><p>value_vars: List of vars we want to melt/put in the same column</p></li>

<li><p>var_name: name of the column for value_vars</p></li>

<li><p>value_name: name of the column for value of value_vars</p></li>
</ul>

<p>There is still one thing remaining. For Prometheus, we see that it is a thriller and the flag is 0. The flag 0 is unnecessary data we can filter out, and we will have our results. We keep only the genres with flag 1</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">reshaped_df  <span style="color:#f92672">=</span> reshaped_df[reshaped_df[<span style="color:#e6db74">&#39;Flag&#39;</span>]<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>]</code></pre></div>
<p><img src="/images/pandas_subset/19.png" alt="" /></p>

<p><strong><em>What if we want to go back?</em></strong></p>

<p>We need the values in a column to become multiple columns. How? We use <code>pivot_table</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">re_reshaped_df <span style="color:#f92672">=</span> reshaped_df<span style="color:#f92672">.</span>pivot_table(index<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Title&#39;</span>,<span style="color:#e6db74">&#39;Rating&#39;</span>,<span style="color:#e6db74">&#39;Votes&#39;</span>,<span style="color:#e6db74">&#39;Rev_M&#39;</span>], columns<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Genre&#39;</span>, 
                        values<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Flag&#39;</span>, aggfunc<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;sum&#39;</span>)<span style="color:#f92672">.</span>reset_index()

re_reshaped_df<span style="color:#f92672">.</span>head()</code></pre></div>
<p><img src="/images/pandas_subset/20.png" alt="" /></p>

<p>We provided four attributes to the pivot_table function.</p>

<ul>
<li><p>index: We don’t want to change these column structures</p></li>

<li><p>columns: explode this column into multiple columns</p></li>

<li><p>values: use this column to aggregate</p></li>

<li><p>aggfunc: the aggregation function.</p></li>
</ul>

<p>We can then fill the missing values by 0 using <code>fillna</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">re_reshaped_df<span style="color:#f92672">=</span>re_reshaped_df<span style="color:#f92672">.</span>fillna(<span style="color:#ae81ff">0</span>)</code></pre></div>
<p><img src="/images/pandas_subset/21.png" alt="" /></p>

<p><strong><em>Recommendation:</em></strong> Multiple columns to one column: melt and One column to multiple columns: pivot_table . There are other ways to do melt — stack and different ways to do pivot_table: pivot,unstack. Stay away from them and just use melt and pivot_table. There are some valid reasons for this like unstack and stack will create multi-index and we don’t want to deal with that, and pivot cannot take multiple columns as the index.</p>

<h2 id="conclusion">Conclusion</h2>

<p><img src="/images/pandas_subset/22.jpg" alt="" /></p>

<blockquote>
<p>With Pandas, less choice is more</p>
</blockquote>

<p><strong><em>Here I have tried to profile some of the most useful functions in pandas I end up using most often.</em></strong></p>

<p>Pandas is a vast library with a lot of functionality and custom options. That makes it essential that you should have a mindmap where you stick to a particular syntax for a specific thing.</p>

<p><strong><em>Here I have shared mine, and you can proceed with it and make it better as your understanding of the library grows.</em></strong></p>

<p>I hope you found this post useful and worth your time. I tried to make this as simple as possible, but you may always <strong>ask me</strong> or see the documentation for doubts.</p>

<p>Whole code and data are posted in the <a href="https://www.kaggle.com/mlwhiz/minimal-pandas-subset" rel="nofollow" target="_blank">Kaggle Kernel</a>.</p>

<p>Also, if you want to learn more about Python 3, I would like to call out an excellent course on Learn <a href="https://bit.ly/2XshreA" rel="nofollow" target="_blank">Intermediate level Python</a> from the University of Michigan. Do check it out.</p>

<p>I am going to be writing more of such posts in the future too. Let me know what you think about them. Follow me up at <a href="https://medium.com/@rahul_agarwal" rel="nofollow" target="_blank"><strong>Medium</strong></a> or Subscribe to my <a href="http://eepurl.com/dbQnuX" rel="nofollow" target="_blank"><strong>blog</strong></a> to be informed about them. As always, I welcome feedback and constructive criticism and can be reached on Twitter <a href="https://twitter.com/MLWhiz" rel="nofollow" target="_blank">@mlwhiz</a>.</p>

		</div>
		
<div class="post__tags tags clearfix">
	<svg class="icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link btn" href="/tags/python/" rel="tag">Python</a></li>
	</ul>
</div>
		

<div class="shareaholic-canvas" data-app="share_buttons" data-app-id="28372088"></div>

<a href="https://click.linksynergy.com/fs-bin/click?id=lVarvwc5BD0&offerid=467035.372&subid=0&type=4" rel="nofollow"><IMG border="0"   alt="Start your future with a Data Science Certificate." src="https://ad.linksynergy.com/fs-bin/show?id=lVarvwc5BD0&bids=467035.372&subid=0&type=4&gridnum=16"></a>





























	</article>
</main>


<nav class="post-nav flex">
	<div class="post-nav__item post-nav__item--prev">
		<a class="post-nav__link" href="/blog/2019/07/07/spark_hitchhiker/" rel="prev"><span class="post-nav__caption">«&thinsp;Previous</span><p class="post-nav__post-title">The Hitchhikers guide to handle Big Data using Spark</p></a>
	</div>
	<div class="post-nav__item post-nav__item--next">
		<a class="post-nav__link" href="/blog/2019/07/21/bandits/" rel="next"><span class="post-nav__caption">Next&thinsp;»</span><p class="post-nav__post-title">Bayesian Bandits explained simply</p></a>
	</div>
</nav>

<section class="comments">
	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "mlwhiz" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


			</div>
			<aside class="sidebar">
  <div style="text-align:center">    
    <a href="https://www.patreon.com/bePatron?u=28135435" data-patreon-widget-type="become-patron-button">Become a Patron!</a><script async src="https://c6.patreon.com/becomePatronButton.bundle.js"></script>
  
	     
  </div>
  <br><div class="widget-search widget">
	<form class="widget-search__form" role="search" method="get" action="https://google.com/search">
		<label>
			<input class="widget-search__field" type="search" placeholder="SEARCH..." value="" name="q" aria-label="SEARCH...">
		</label>
		<input class="widget-search__submit" type="submit" value="Search">
		<input type="hidden" name="sitesearch" value="https://mlwhiz.com/" />
	</form>
</div>
<div class="widget-recent widget">
	<h4 class="widget__title">Recent Posts</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/blog/2019/12/25/prod/">Take your Machine Learning Models to Production with these 5 simple steps</a></li>
			<li class="widget__item"><a class="widget__link" href="/blog/2019/12/24/mistakes/">3 Mistakes you should not make in a Data Science Interview</a></li>
			<li class="widget__item"><a class="widget__link" href="/blog/2019/12/09/pc/">3 Programming concepts for Data Scientists</a></li>
			<li class="widget__item"><a class="widget__link" href="/blog/2019/12/07/streamlit/">How to write Web apps using simple Python for Data Scientists?</a></li>
			<li class="widget__item"><a class="widget__link" href="/blog/2019/12/06/weapons/">Implementing Object Detection and Instance Segmentation for Data Scientists</a></li>
			<li class="widget__item"><a class="widget__link" href="/blog/2019/12/05/od/">Demystifying Object Detection and Instance Segmentation for Data Scientists</a></li>
			<li class="widget__item"><a class="widget__link" href="/blog/2019/12/04/blackbox/">How to find Feature importances for BlackBox Models?</a></li>
			<li class="widget__item"><a class="widget__link" href="/blog/2019/11/27/cities/">Top 5 Cities for Data Scientists to Thrive In</a></li>
			<li class="widget__item"><a class="widget__link" href="/blog/2019/11/12/dtsplits/">The Simple Math behind 3 Decision Tree Splitting criterions</a></li>
			<li class="widget__item"><a class="widget__link" href="/blog/2019/11/11/pval/">P-value Explained Simply for Data Scientists</a></li>
		</ul>
	</div>
</div>


<div class="shareaholic-canvas" data-app="follow_buttons" data-app-id="28033293" style="white-space: inherit;"></div>


<link href="//cdn-images.mailchimp.com/embedcode/slim-10_7.css" rel="stylesheet" type="text/css">


<style type="text/css">
  #mc_embed_signup .button {background-color: #127edc;}
  #mc_embed_signup form .center{
    display: block;
    position: relative;
    text-align: center;
    padding: 10px -5px 10px 3%;}
   
</style>
<div id="mc_embed_signup">
<form action="//mlwhiz.us15.list-manage.com/subscribe/post?u=4e9962f4ce4a94818bcc2f249&amp;id=87a48fafdd" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
    <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_4e9962f4ce4a94818bcc2f249_87a48fafdd" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>

</aside>
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy;  2014-2019 Rahul Agarwal.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>



	</div>
<script src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&adInstanceId=93f2f4f9-cf51-415d-84af-08cbb74b178f"></script>
<script async defer src="/js/menu.js"></script></body>
</html>