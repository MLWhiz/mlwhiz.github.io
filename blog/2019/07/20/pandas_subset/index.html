<!doctype html><html lang=en-us><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-F34XSWQ5N4"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F34XSWQ5N4")</script><meta charset=utf-8><title>Minimal Pandas Subset for Data Scientists - MLWhiz</title>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="There are multiple ways to doing the same thing in Pandas, and that might make it troublesome for the beginner user.This post is about handling most of the data manipulation cases in Python using a straightforward, simple, and matter of fact way."><meta name=author content="Rahul Agarwal"><meta name=generator content="Hugo 0.139.2"><link rel=stylesheet href=https://mlwhiz.com/plugins/compressjscss/main.css><meta property="og:title" content="Minimal Pandas Subset for Data Scientists - MLWhiz"><meta property="og:description" content="There are multiple ways to doing the same thing in Pandas, and that might make it troublesome for the beginner user.This post is about handling most of the data manipulation cases in Python using a straightforward, simple, and matter of fact way."><meta property="og:type" content="article"><meta property="og:url" content="https://mlwhiz.com/blog/2019/07/20/pandas_subset/"><meta property="og:image" content="https://mlwhiz.com/images/pandas_subset/1.jpeg"><meta property="og:image:secure_url" content="https://mlwhiz.com/images/pandas_subset/1.jpeg"><meta property="article:published_time" content="2019-07-20T00:00:00+00:00"><meta property="article:modified_time" content="2022-04-13T13:34:49+01:00"><meta property="article:tag" content="Awesome Guides"><meta property="article:tag" content="Data Science"><meta name=twitter:card content="summary"><meta name=twitter:image content="https://mlwhiz.com/images/pandas_subset/1.jpeg"><meta name=twitter:title content="Minimal Pandas Subset for Data Scientists - MLWhiz"><meta name=twitter:description content="There are multiple ways to doing the same thing in Pandas, and that might make it troublesome for the beginner user.This post is about handling most of the data manipulation cases in Python using a straightforward, simple, and matter of fact way."><meta name=twitter:site content="@mlwhiz"><meta name=twitter:creator content="@mlwhiz"><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href=https://mlwhiz.com/scss/style.min.css media=screen><link rel=stylesheet href=/css/style.css><link rel=stylesheet type=text/css href=/css/font/flaticon.css><link rel="shortcut icon" href=https://mlwhiz.com/images/logos/favicon-32x32.png type=image/x-icon><link rel=icon href=https://mlwhiz.com/images/logos/favicon.ico type=image/x-icon><link rel=canonical href=https://mlwhiz.com/blog/2019/07/20/pandas_subset/><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://www.mlwhiz.com/#website","url":"https://www.mlwhiz.com/","name":"MLWhiz","description":"Want to Learn Computer Vision and NLP? - MLWhiz","potentialAction":{"@type":"SearchAction","target":"https://www.mlwhiz.com/search?s={search_term_string}","query-input":"required name=search_term_string"}},{"@type":"ImageObject","@id":"https://mlwhiz.com/blog/2019/07/20/pandas_subset/#primaryimage","url":"https://mlwhiz.com/images/pandas_subset/1.jpeg","width":700,"height":450},{"@type":"WebPage","@id":"https://mlwhiz.com/blog/2019/07/20/pandas_subset/#webpage","url":"https://mlwhiz.com/blog/2019/07/20/pandas_subset/","inLanguage":"en-US","name":"Minimal Pandas Subset for Data Scientists - MLWhiz","isPartOf":{"@id":"https://www.mlwhiz.com/#website"},"primaryImageOfPage":{"@id":"https://mlwhiz.com/blog/2019/07/20/pandas_subset/#primaryimage"},"datePublished":"2019-07-20T00:00:00.00Z","dateModified":"2022-04-13T13:34:49.00Z","author":{"@id":"https://mlwhiz.com/about/#/schema/person/76376876bchxkzbchjsdjcca"},"description":"There are multiple ways to doing the same thing in Pandas, and that might make it troublesome for the beginner user.This post is about handling most of the data manipulation cases in Python using a straightforward, simple, and matter of fact way."},{"@type":["Person"],"@id":"https://mlwhiz.com/about/#/schema/person/76376876bchxkzbchjsdjcca","name":"Rahul Agarwal","image":{"@type":"ImageObject","@id":"https://www.mlwhiz.com/#authorlogo","url":"https://mlwhiz.com/images/author.jpg","caption":"Rahul Agarwal"},"description":"Hi there, I\u2019m Rahul Agarwal. I\u2019m a data scientist consultant and big data engineer based in Bangalore. I see a lot of times  students and even professionals wasting their time and struggling to get started with Computer Vision, Deep Learning, and NLP. I Started this Site with a purpose to augment my own understanding about new things while helping others learn about them in the best possible way.","sameAs":["https://www.linkedin.com/in/rahulagwl/","https://medium.com/@rahul_agarwal","https://twitter.com/MLWhiz","https://www.facebook.com/mlwhizblog","https://github.com/MLWhiz","https://www.instagram.com/itsmlwhiz"]}]}</script><script async data-uid=a0ebaf958d src=https://mlwhiz.ck.page/a0ebaf958d/index.js></script><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"]],processEscapes:!0,processEnvironments:!0,skipTags:["script","noscript","style","textarea","pre"],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var e,t=MathJax.Hub.getAllJax();for(e=0;e<t.length;e+=1)t[e].SourceElement().parentNode.className+=" has-jax"}),MathJax.Hub.Config({TeX:{equationNumbers:{autoNumber:"AMS"}}})</script><link href=//apps.shareaholic.com/assets/pub/shareaholic.js as=script><script type=text/javascript data-cfasync=false async src=//apps.shareaholic.com/assets/pub/shareaholic.js data-shr-siteid=fd1ffa7fd7152e4e20568fbe49a489d0></script><script>!function(e,t,n,s,o,i,a){if(e.fbq)return;o=e.fbq=function(){o.callMethod?o.callMethod.apply(o,arguments):o.queue.push(arguments)},e._fbq||(e._fbq=o),o.push=o,o.loaded=!0,o.version="2.0",o.queue=[],i=t.createElement(n),i.async=!0,i.src=s,a=t.getElementsByTagName(n)[0],a.parentNode.insertBefore(i,a)}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js"),fbq("init","402633927768628"),fbq("track","PageView")</script><noscript><img height=1 width=1 style=display:none src="https://www.facebook.com/tr?id=402633927768628&ev=PageView&noscript=1"></noscript><meta property="fb:pages" content="213104036293742"><meta name=facebook-domain-verification content="qciidcy7mm137sewruizlvh8zbfnv4"><meta name=impact-site-verification value=1670148355></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NMQD44T" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><div class=preloader></div><header class=navigation><div class=container><nav class="navbar navbar-expand-lg navbar-white bg-transparent border-bottom pl-0"><a class="navbar-brand mobile-view" href=https://mlwhiz.com/><img class=img-fluid src=https://mlwhiz.com/images/logos/logo.svg alt="MLWhiz - Your Home for DS, ML, AI!"></a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class="ti-menu h3"></i></button><div class="collapse navbar-collapse text-center" id=navigation><div class=desktop-view><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href="https://linkedin.com/comm/mynetwork/discovery-see-all?usecase=PEOPLE_FOLLOWS&amp;followMember=rahulagwl"><i class=ti-linkedin></i></a></li><li class=nav-item><a class=nav-link href=https://mlwhiz.medium.com/><i class=ti-book></i></a></li><li class=nav-item><a class=nav-link href=https://twitter.com/MLWhiz><i class=ti-twitter-alt></i></a></li><li class=nav-item><a class=nav-link href=https://www.facebook.com/mlwhizblog><i class=ti-facebook></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/MLWhiz><i class=ti-github></i></a></li></ul></div><a class="navbar-brand mx-auto desktop-view" href=https://mlwhiz.com/><img class=img-fluid-custom src=https://mlwhiz.com/images/logos/logo.svg alt="MLWhiz - Your Home for DS, ML, AI!"></a><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://mlwhiz.com/about>About</a></li><li class=nav-item><a class=nav-link href=https://mlwhiz.com/blog>Blog</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Topics</a><div class=dropdown-menu><a class=dropdown-item href=https://mlwhiz.com/categories/natural-language-processing>NLP</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/computer-vision>Computer Vision</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/deep-learning>Deep Learning</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/data-science>DS/ML</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/big-data>Big Data</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/awesome-guides>My Best Content</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/learning-resources>Learning Resources</a></div></li></ul><div class="search pl-lg-4"><button id=searchOpen class=search-btn><i class=ti-search></i></button><div class=search-wrapper><form action=https://mlwhiz.com//search class=h-100><input class="search-box px-4" id=search-query name=s type=search placeholder="Type & Hit Enter..."></form><button id=searchClose class=search-close><i class="ti-close text-dark"></i></button></div></div></div></nav></div></header><section class=section-sm><div class=container><div class=row><div class="col-lg-8 mb-5 mb-lg-0"><a href=/categories/awesome-guides class=categoryStyle>Awesome Guides</a>
<a href=/categories/data-science class=categoryStyle>Data Science</a><h1>Minimal Pandas Subset for Data Scientists</h1><div class="mb-3 post-meta"><span>By Rahul Agarwal</span>
<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg>
<span>20 July 2019</span></div><img src=https://mlwhiz.com/images/pandas_subset/1.jpeg class="img-fluid w-100 mb-4" alt="Minimal Pandas Subset for Data Scientists"><div class="content mb-5"><p>Pandas is a vast library.</p><p>Data manipulation is a breeze with pandas, and it has become such a standard for it that a lot of parallelization libraries like Rapids and Dask are being created in line with Pandas syntax.</p><p>Still, I generally have some issues with it.</p><p><em><strong>There are multiple ways to doing the same thing in Pandas, and that might make it troublesome for the beginner user.</strong></em></p><p>This has inspired me to come up with a minimal subset of pandas functions I use while coding.</p><p>I have tried it all, and currently, I stick to a particular way. It is like a mind map.</p><p><em><strong>Sometimes because it is fast and sometimes because it’s more readable and sometimes because I can do it with my current knowledge. And sometimes because I know that a particular way will be a headache in the long run(think multi-index)</strong></em></p><p><em><strong>This post is about handling most of the data manipulation cases in Python using a straightforward, simple, and matter of fact way.</strong></em></p><p>With a sprinkling of some recommendations throughout.</p><p>I will be using a data set of 1,000 popular movies on IMDB in the last ten years. You can also follow along in the
<a href=https://www.kaggle.com/mlwhiz/minimal-pandas-subset target=_blank rel="nofollow noopener">Kaggle Kernel</a>
.</p><hr><h2 id=some-default-pandas-requirements>Some Default Pandas Requirements</h2><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset='/images/pandas_subset/2_hu7398379477068459538.png 500w
, /images/pandas_subset/2_hu259696336240192047.png 800w
, /images/pandas_subset/2_hu16837112217492860280.png 1200w' src=/images/pandas_subset/2.png alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p>As good as the Jupyter notebooks are, some things still need to be specified when working with Pandas.</p><p>***Sometimes your notebook won’t show you all the columns. Sometimes it will display all the rows if you print the dataframe. ***You can control this behavior by setting some defaults of your own while importing Pandas. You can automate it using
<a href=https://towardsdatascience.com/three-great-additions-for-your-jupyter-notebooks-cd7373b00e96 target=_blank rel="nofollow noopener">this addition</a>
to your notebook.</p><p>For instance, this is the setting I use.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#6ab825;font-weight:700>import</span> <span style=color:#447fcf;text-decoration:underline>pandas</span> <span style=color:#6ab825;font-weight:700>as</span> <span style=color:#447fcf;text-decoration:underline>pd</span>
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic># pandas defaults</span>
</span></span><span style=display:flex><span>pd.options.display.max_columns = <span style=color:#3677a9>500</span>
</span></span><span style=display:flex><span>pd.options.display.max_rows = <span style=color:#3677a9>500</span>
</span></span></code></pre></div><hr><h2 id=reading-data-with-pandas>Reading Data with Pandas</h2><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset='/images/pandas_subset/3_hu17716879027985103741.jpg 500w
, /images/pandas_subset/3_hu12571984978210999108.jpg 800w
, /images/pandas_subset/3_hu11659057526366512615.jpg 1200w' src=/images/pandas_subset/3.jpg alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p>The first thing we do is reading the data source and so here is the code for that.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>df = pd.read_csv(<span style=color:#ed9d13>&#34;IMDB-Movie-Data.csv&#34;</span>)
</span></span></code></pre></div><p><em><strong>Recommendation:</strong></em> I could also have used pd.read_table to read the file. The thing is that pd.read_csv has default separator as , and thus it saves me some code. I also genuinely don’t understand the use of pd.read_table</p><p>If your data is in some SQL Datasource, you could have used the following code. You get the results in the dataframe format.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#999;font-style:italic># Reading from SQL Datasource</span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>import</span> <span style=color:#447fcf;text-decoration:underline>MySQLdb</span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>from</span> <span style=color:#447fcf;text-decoration:underline>pandas</span> <span style=color:#6ab825;font-weight:700>import</span> DataFrame
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>from</span> <span style=color:#447fcf;text-decoration:underline>pandas.io.sql</span> <span style=color:#6ab825;font-weight:700>import</span> read_sql
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>db = MySQLdb.connect(host=<span style=color:#ed9d13>&#34;localhost&#34;</span>,    <span style=color:#999;font-style:italic># your host, usually localhost</span>
</span></span><span style=display:flex><span>                     user=<span style=color:#ed9d13>&#34;root&#34;</span>,         <span style=color:#999;font-style:italic># your username</span>
</span></span><span style=display:flex><span>                     passwd=<span style=color:#ed9d13>&#34;password&#34;</span>,   <span style=color:#999;font-style:italic># your password</span>
</span></span><span style=display:flex><span>                     db=<span style=color:#ed9d13>&#34;dbname&#34;</span>)         <span style=color:#999;font-style:italic># name of the data base</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>query = <span style=color:#ed9d13>&#34;SELECT * FROM tablename&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df = read_sql(query, db)
</span></span></code></pre></div><hr><h2 id=data-snapshot>Data Snapshot</h2><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset='/images/pandas_subset/4_hu11190912066341376335.jpg 500w
, /images/pandas_subset/4_hu2256574567692299503.jpg 800w
, /images/pandas_subset/4_hu15115082533952026909.jpg 1200w' src=/images/pandas_subset/4.jpg alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p>Always useful to see some of the data.</p><p>You can use simple head and tail commands with an option to specify the number of rows.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#999;font-style:italic># top 5 rows</span>
</span></span><span style=display:flex><span>df.head()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic># top 50 rows</span>
</span></span><span style=display:flex><span>df.head(<span style=color:#3677a9>50</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic># last 5 rows</span>
</span></span><span style=display:flex><span>df.tail()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic># last 50 rows</span>
</span></span><span style=display:flex><span>df.tail(<span style=color:#3677a9>50</span>)
</span></span></code></pre></div><p>You can also see simple dataframe statistics with the following commands.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#999;font-style:italic># To get statistics of numerical columns</span>
</span></span><span style=display:flex><span>df.describe()
</span></span></code></pre></div><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset='/images/pandas_subset/4a_hu8980868182033035089.png 500w
, /images/pandas_subset/4a_hu9791360722294956361.png 800w
, /images/pandas_subset/4a_hu17526061945490836422.png 1200w' src=/images/pandas_subset/4a.png alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#999;font-style:italic># To get maximum value of a column. When you take a single column you can think of it as a list and apply functions you would apply to a list. You can also use min for instance.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#24909d>print</span>(<span style=color:#24909d>max</span>(df[<span style=color:#ed9d13>&#39;rating&#39;</span>]))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic># no of rows in dataframe</span>
</span></span><span style=display:flex><span><span style=color:#24909d>print</span>(<span style=color:#24909d>len</span>(df))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic># Shape of Dataframe</span>
</span></span><span style=display:flex><span><span style=color:#24909d>print</span>(df.shape)
</span></span></code></pre></div><pre><code>9.0
1000
(1000,12)
</code></pre><p><em><strong>Recommendation:</strong></em> Generally working with Jupyter notebook,<em><strong>I make it a point of having the first few cells in my notebook containing these snapshots</strong></em> of the data. This helps me see the structure of the data whenever I want to. If I don’t follow this practice, I notice that I end up repeating the <code>.head()</code> command a lot of times in my code.</p><hr><h2 id=handling-columns-in-dataframes>Handling Columns in Dataframes</h2><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset='/images/pandas_subset/5_hu10502010979864894996.jpg 500w
, /images/pandas_subset/5_hu16805672633594755984.jpg 800w' src=/images/pandas_subset/5.jpg alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><h3 id=a-selecting-a-column>a. Selecting a column</h3><p>For some reason Pandas lets you choose columns in two ways. Using the dot operator like <code>df.Title</code> and using square brackets like <code>df['Title']</code></p><p>I prefer the second version, mostly. Why?</p><p>There are a couple of reasons you would be better off with the square bracket version in the longer run.</p><ul><li><p>If your column name contains spaces, then the dot version won’t work. For example, <code>df.Revenue (Millions)</code> won’t work while <code>df['Revenue (Millions)']</code> will.</p></li><li><p>It also won’t work if your column name is <code>count</code> or <code>mean</code> or any of pandas predefined functions.</p></li><li><p>Sometimes you might need to create a for loop over your column names in which your column name might be in a variable. In that case, the dot notation will not work. For Example, This works:</p></li></ul><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>colname = <span style=color:#ed9d13>&#39;height&#39;</span>
</span></span><span style=display:flex><span>df[colname]
</span></span></code></pre></div><p>While this doesn’t:</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>colname = <span style=color:#ed9d13>&#39;height&#39;</span>
</span></span><span style=display:flex><span>df.colname
</span></span></code></pre></div><p>Trust me. Saving a few characters is not worth it.</p><p><em><strong>Recommendation: Stop using the dot operator</strong></em>. It is a construct that originated from a different language(R) and respectfully should be left there.</p><h3 id=b-getting-column-names-in-a-list>b. Getting Column Names in a list</h3><p>You might need a list of columns for some later processing.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>columnnames = df.columns
</span></span></code></pre></div><h3 id=c-specifying-user-defined-column-names>c. Specifying user-defined Column Names:</h3><p>Sometimes you want to change the column names as per your taste. I don’t like spaces in my column names, so I change them as such.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>df.columns = [<span style=color:#ed9d13>&#39;Rank&#39;</span>, <span style=color:#ed9d13>&#39;Title&#39;</span>, <span style=color:#ed9d13>&#39;Genre&#39;</span>, <span style=color:#ed9d13>&#39;Description&#39;</span>, <span style=color:#ed9d13>&#39;Director&#39;</span>, <span style=color:#ed9d13>&#39;Actors&#39;</span>, <span style=color:#ed9d13>&#39;Year&#39;</span>,
</span></span><span style=display:flex><span>       <span style=color:#ed9d13>&#39;Runtime_Minutes&#39;</span>, <span style=color:#ed9d13>&#39;Rating&#39;</span>, <span style=color:#ed9d13>&#39;Votes&#39;</span>, <span style=color:#ed9d13>&#39;Revenue_Millions&#39;</span>,
</span></span><span style=display:flex><span>       <span style=color:#ed9d13>&#39;Metascore&#39;</span>]
</span></span></code></pre></div><p>I could have used another way.</p><p>This is the one case where both of the versions are important. When I have to change a lot of column names, I go with the way above. When I have to change the name of just one or two columns I use:</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>df.rename(columns = {<span style=color:#ed9d13>&#39;Revenue (Millions)&#39;</span>:<span style=color:#ed9d13>&#39;Rev_M&#39;</span>,<span style=color:#ed9d13>&#39;Runtime (Minutes)&#39;</span>:<span style=color:#ed9d13>&#39;Runtime_min&#39;</span>},inplace=<span style=color:#6ab825;font-weight:700>True</span>)
</span></span></code></pre></div><h3 id=d-subsetting-specific-columns>d. Subsetting specific columns:</h3><p>Sometimes you only need to work with particular columns in a dataframe. e.g., to separate numerical and categorical columns, or remove unnecessary columns. Let’s say in our example; we don’t need the description, director, and actor column.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>df = df[[<span style=color:#ed9d13>&#39;Rank&#39;</span>, <span style=color:#ed9d13>&#39;Title&#39;</span>, <span style=color:#ed9d13>&#39;Genre&#39;</span>, <span style=color:#ed9d13>&#39;Year&#39;</span>,<span style=color:#ed9d13>&#39;Runtime_min&#39;</span>, <span style=color:#ed9d13>&#39;Rating&#39;</span>, <span style=color:#ed9d13>&#39;Votes&#39;</span>, <span style=color:#ed9d13>&#39;Rev_M&#39;</span>, <span style=color:#ed9d13>&#39;Metascore&#39;</span>]]
</span></span></code></pre></div><h3 id=e-seeing-column-types>e. Seeing column types:</h3><p>Very useful while debugging. If your code throws an error that you cannot add a str and int, you will like to run this command.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>df.dtypes
</span></span></code></pre></div><hr><h2 id=applying-functions-on-dataframe-apply-and-lambda>Applying Functions on DataFrame: Apply and Lambda</h2><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset='/images/pandas_subset/6_hu4799339188512553271.png 500w
, /images/pandas_subset/6_hu7122213952945105915.png 800w
, /images/pandas_subset/6_hu5968330866615908103.png 1200w' src=/images/pandas_subset/6.png alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p><code>apply</code> and <code>lambda</code> are some of the best things I have learned to use with pandas.</p><p>I use <code>apply</code> and <code>lambda</code> anytime I get stuck while building a complex logic for a new column or filter.</p><h3 id=a-creating-a-column>a. Creating a Column</h3><p>You can create a new column in many ways.</p><p>If you want a column that is a sum or difference of columns, you can pretty much use simple basic arithmetic. Here I get the average rating based on IMDB and Normalized Metascore.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>df[<span style=color:#ed9d13>&#39;AvgRating&#39;</span>] = (df[<span style=color:#ed9d13>&#39;Rating&#39;</span>] + df[<span style=color:#ed9d13>&#39;Metascore&#39;</span>]/<span style=color:#3677a9>10</span>)/<span style=color:#3677a9>2</span>
</span></span></code></pre></div><p>But sometimes we may need to build complex logic around the creation of new columns.</p><p>To give you a convoluted example, let’s say that we want to build a custom movie score based on a variety of factors.</p><p><em><strong>Say, If the movie is of the thriller genre, I want to add 1 to the IMDB rating subject to the condition that IMDB rating remains less than or equal to 10. And If a movie is a comedy I want to subtract one from the rating.</strong></em></p><p><em><strong>How do we do that?</strong></em></p><p>Whenever I get a hold of such complex problems, I use <code>apply/lambda</code>. Let me first show you how I will do this.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#6ab825;font-weight:700>def</span> <span style=color:#447fcf>custom_rating</span>(genre,rating):
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>if</span> <span style=color:#ed9d13>&#39;Thriller&#39;</span> <span style=color:#6ab825;font-weight:700>in</span> genre:
</span></span><span style=display:flex><span>        <span style=color:#6ab825;font-weight:700>return</span> <span style=color:#24909d>min</span>(<span style=color:#3677a9>10</span>,rating+<span style=color:#3677a9>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>elif</span> <span style=color:#ed9d13>&#39;Comedy&#39;</span> <span style=color:#6ab825;font-weight:700>in</span> genre:
</span></span><span style=display:flex><span>        <span style=color:#6ab825;font-weight:700>return</span> <span style=color:#24909d>max</span>(<span style=color:#3677a9>0</span>,rating-<span style=color:#3677a9>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#6ab825;font-weight:700>return</span> rating
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df[<span style=color:#ed9d13>&#39;CustomRating&#39;</span>] = df.apply(<span style=color:#6ab825;font-weight:700>lambda</span> x: custom_rating(x[<span style=color:#ed9d13>&#39;Genre&#39;</span>],x[<span style=color:#ed9d13>&#39;Rating&#39;</span>]),axis=<span style=color:#3677a9>1</span>)
</span></span></code></pre></div><p>The general structure is:</p><ul><li><p>You define a function that will take the column values you want to play with to come up with your logic. Here the only two columns we end up using are genre and rating.</p></li><li><p>You use an apply function with lambda along the row with axis=1. The general syntax is:</p></li></ul><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>df.apply(<span style=color:#6ab825;font-weight:700>lambda</span> x: func(x[<span style=color:#ed9d13>&#39;col1&#39;</span>],x[<span style=color:#ed9d13>&#39;col2&#39;</span>]),axis=<span style=color:#3677a9>1</span>)
</span></span></code></pre></div><p>You should be able to create pretty much any logic using apply/lambda since you just have to worry about the custom function.</p><h3 id=b-filtering-a-dataframe>b. Filtering a dataframe</h3><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset='/images/pandas_subset/7_hu17438426853988755127.jpeg 500w
, /images/pandas_subset/7_hu9201229199115871780.jpeg 800w
, /images/pandas_subset/7_hu7890940703160347747.jpeg 1200w' src=/images/pandas_subset/7.jpeg alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p>Pandas make filtering and subsetting dataframes pretty easy. You can filter and subset dataframes using normal operators and <code>&,|,~</code> operators.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#999;font-style:italic># Single condition: dataframe with all movies rated greater than 8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df_gt_8 = df[df[<span style=color:#ed9d13>&#39;Rating&#39;</span>]&gt;<span style=color:#3677a9>8</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic># Multiple conditions: AND - dataframe with all movies rated greater than 8 and having more than 100000 votes</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>And_df = df[(df[<span style=color:#ed9d13>&#39;Rating&#39;</span>]&gt;<span style=color:#3677a9>8</span>) &amp; (df[<span style=color:#ed9d13>&#39;Votes&#39;</span>]&gt;<span style=color:#3677a9>100000</span>)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic># Multiple conditions: OR - dataframe with all movies rated greater than 8 or having a metascore more than 90</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Or_df = df[(df[<span style=color:#ed9d13>&#39;Rating&#39;</span>]&gt;<span style=color:#3677a9>8</span>) | (df[<span style=color:#ed9d13>&#39;Metascore&#39;</span>]&gt;<span style=color:#3677a9>80</span>)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic># Multiple conditions: NOT - dataframe with all emovies rated greater than 8 or having a metascore more than 90 have to be excluded</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Not_df = df[~((df[<span style=color:#ed9d13>&#39;Rating&#39;</span>]&gt;<span style=color:#3677a9>8</span>) | (df[<span style=color:#ed9d13>&#39;Metascore&#39;</span>]&gt;<span style=color:#3677a9>80</span>))]
</span></span></code></pre></div><p>Pretty simple stuff.</p><p>But sometimes we may need to do complex filtering operations.</p><p>And sometimes we need to do some operations which we won’t be able to do using just the above format.</p><p>For instance: Let us say <em><strong>we want to filter those rows where the number of words in the movie title is greater than or equal to than 4.</strong></em></p><p><em><strong>How would you do it?</strong></em></p><p>Trying the below will give you an error. Apparently, you cannot do anything as simple as split with a series.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>new_df = df[<span style=color:#24909d>len</span>(df[<span style=color:#ed9d13>&#39;Title&#39;</span>].split(<span style=color:#ed9d13>&#34; &#34;</span>))&gt;=<span style=color:#3677a9>4</span>]
</span></span></code></pre></div><pre><code>AttributeError: 'Series' object has no attribute 'split'
</code></pre><p>One way is first to create a column which contains no of words in the title using apply and then filter on that column.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#999;font-style:italic>#create a new column</span>
</span></span><span style=display:flex><span>df[<span style=color:#ed9d13>&#39;num_words_title&#39;</span>] = df.apply(<span style=color:#6ab825;font-weight:700>lambda</span> x : <span style=color:#24909d>len</span>(x[<span style=color:#ed9d13>&#39;Title&#39;</span>].split(<span style=color:#ed9d13>&#34; &#34;</span>)),axis=<span style=color:#3677a9>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic>#simple filter on new column</span>
</span></span><span style=display:flex><span>new_df = df[df[<span style=color:#ed9d13>&#39;num_words_title&#39;</span>]&gt;=<span style=color:#3677a9>4</span>]
</span></span></code></pre></div><p>And that is a perfectly fine way as long as you don’t have to create a lot of columns. But I prefer this:</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>new_df = df[df.apply(<span style=color:#6ab825;font-weight:700>lambda</span> x : <span style=color:#24909d>len</span>(x[<span style=color:#ed9d13>&#39;Title&#39;</span>].split(<span style=color:#ed9d13>&#34; &#34;</span>))&gt;=<span style=color:#3677a9>4</span>,axis=<span style=color:#3677a9>1</span>)]
</span></span></code></pre></div><p>What I did here is that <em><strong>my apply function returns a boolean which can be used to filter.</strong></em></p><p>Now once you understand that you just have to create a column of booleans to filter, you can use any function/logic in your apply statement to get however complex a logic you want to build.</p><p>Let us see another example. I will try to do something a little complex to show the structure.</p><p><em><strong>We want to find movies for which the revenue is less than the average revenue for that particular year?</strong></em></p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>year_revenue_dict = df.groupby([<span style=color:#ed9d13>&#39;Year&#39;</span>]).agg({<span style=color:#ed9d13>&#39;Rev_M&#39;</span>:np.mean}).to_dict()[<span style=color:#ed9d13>&#39;Rev_M&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>def</span> <span style=color:#447fcf>bool_provider</span>(revenue, year):
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>return</span> revenue&lt;year_revenue_dict[year]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>new_df = df[df.apply(<span style=color:#6ab825;font-weight:700>lambda</span> x : bool_provider(x[<span style=color:#ed9d13>&#39;Rev_M&#39;</span>],x[<span style=color:#ed9d13>&#39;Year&#39;</span>]),axis=<span style=color:#3677a9>1</span>)]
</span></span></code></pre></div><p>We have a function here which we can use to write any logic. That provides a lot of power for advanced filtering as long as we can play with simple variables.</p><h3 id=c-change-column-types>c. Change Column Types</h3><p>I even use apply to change the column types since I don’t want to remember the syntax for changing column type and also since it lets me do much more complicated things.</p><p>The usual syntax to change column type is astype in Pandas. So if I had a column named price in my data in an str format. I could do this:</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>df[<span style=color:#ed9d13>&#39;Price&#39;</span>] = newDf[<span style=color:#ed9d13>&#39;Price&#39;</span>].astype(<span style=color:#ed9d13>&#39;int&#39;</span>)
</span></span></code></pre></div><p>But sometimes it won’t work as expected.</p><p>You might get the error: <code>ValueError: invalid literal for long() with base 10: ‘13,000’</code>. That is you cannot cast a string with “,” to an int. To do that we first have to get rid of the comma.</p><p>After facing this problem time and again, I have stopped using astype altogether now and just use apply to change column types.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>df[<span style=color:#ed9d13>&#39;Price&#39;</span>] = df.apply(<span style=color:#6ab825;font-weight:700>lambda</span> x: <span style=color:#24909d>int</span>(x[<span style=color:#ed9d13>&#39;Price&#39;</span>].replace(<span style=color:#ed9d13>&#39;,&#39;</span>, <span style=color:#ed9d13>&#39;&#39;</span>)),axis=<span style=color:#3677a9>1</span>)
</span></span></code></pre></div><h3 id=and-lastly-there-is-progress_apply>And lastly, there is progress_apply</h3><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset='/images/pandas_subset/8_hu4941199545549466699.png 500w
, /images/pandas_subset/8_hu12830848120315058118.png 800w
, /images/pandas_subset/8_hu11626142263743152586.png 1200w' src=/images/pandas_subset/8.png alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p><code>progress_apply</code> is a function that comes with <code>tqdm</code> package.</p><p>And this has saved me a lot of time.</p><p>Sometimes when you have got a lot of rows in your data, or you end up writing a pretty complex apply function, you will see that apply might take a lot of time.</p><p>I have seen apply taking hours when working with Spacy. In such cases, you might like to see the progress bar with <code>apply</code>.</p><p>You can use <code>tqdm</code> for that.</p><p>After the initial imports at the top of your notebook, just replace <code>apply</code> with <code>progress_apply</code> and everything remains the same.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#6ab825;font-weight:700>from</span> <span style=color:#447fcf;text-decoration:underline>tqdm</span> <span style=color:#6ab825;font-weight:700>import</span> tqdm, tqdm_notebook
</span></span><span style=display:flex><span>tqdm_notebook().pandas()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df.progress_apply(<span style=color:#6ab825;font-weight:700>lambda</span> x: custom_rating_function(x[<span style=color:#ed9d13>&#39;Genre&#39;</span>],x[<span style=color:#ed9d13>&#39;Rating&#39;</span>]),axis=<span style=color:#3677a9>1</span>)
</span></span></code></pre></div><p>And you get progress bars.</p><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset='/images/pandas_subset/9_hu3820541338411002878.png 500w
, /images/pandas_subset/9_hu1420563088282654671.png 800w
, /images/pandas_subset/9_hu2299039277179735627.png 1200w' src=/images/pandas_subset/9.png alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p>***Recommendation:***vWhenever you see that you have to create a column with custom complex logic, think of apply and lambda. Try using progress_apply too.</p><hr><h2 id=aggregation-on-dataframes-groupby>Aggregation on Dataframes: groupby</h2><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset='/images/pandas_subset/10_hu13363727158008447655.jpg 500w
, /images/pandas_subset/10_hu9948817336134279843.jpg 800w' src=/images/pandas_subset/10.jpg alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p>groupby will come up a lot of times whenever you want to aggregate your data. Pandas lets you do this efficiently with the groupby function.</p><p>There are a lot of ways that you can use groupby. I have seen a lot of versions, but I prefer a particular style since I feel the version I use is easy, intuitive, and scalable for different use cases.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>df.groupby(<span style=color:#24909d>list</span> of columns to groupby on).aggregate({<span style=color:#ed9d13>&#39;colname&#39;</span>:func1, <span style=color:#ed9d13>&#39;colname2&#39;</span>:func2}).reset_index()
</span></span></code></pre></div><p>Now you see it is pretty simple. You just have to worry about supplying two primary pieces of information.</p><ul><li><p>List of columns to groupby on, and</p></li><li><p>A dictionary of columns and functions you want to apply to those columns</p></li></ul><p>reset_index() is a function that resets the index of a dataframe. I apply this function ALWAYS whenever I do a groupby, and you might think of it as a default syntax for groupby operations.</p><p>Let us check out an example.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#999;font-style:italic># Find out the sum of votes and revenue by year</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>import</span> <span style=color:#447fcf;text-decoration:underline>numpy</span> <span style=color:#6ab825;font-weight:700>as</span> <span style=color:#447fcf;text-decoration:underline>np</span>
</span></span><span style=display:flex><span>df.groupby([<span style=color:#ed9d13>&#39;Year&#39;</span>]).aggregate({<span style=color:#ed9d13>&#39;Votes&#39;</span>:np.sum, <span style=color:#ed9d13>&#39;Rev_M&#39;</span>:np.sum}).reset_index()
</span></span></code></pre></div><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset='/images/pandas_subset/11_hu5321253201684215031.png 500w
, /images/pandas_subset/11_hu4183133149147000050.png 800w
, /images/pandas_subset/11_hu5522559030415863915.png 1200w' src=/images/pandas_subset/11.png alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p>You might also want to group by more than one column. It is fairly straightforward.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>df.groupby([<span style=color:#ed9d13>&#39;Year&#39;</span>,<span style=color:#ed9d13>&#39;Genre&#39;</span>]).aggregate({<span style=color:#ed9d13>&#39;Votes&#39;</span>:np.sum, <span style=color:#ed9d13>&#39;Rev_M&#39;</span>:np.sum}).reset_index()
</span></span></code></pre></div><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset='/images/pandas_subset/12_hu7216484355404408182.png 500w
, /images/pandas_subset/12_hu16875315967954043694.png 800w
, /images/pandas_subset/12_hu2083972484367211471.png 1200w' src=/images/pandas_subset/12.png alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p><em><strong>Recommendation:</strong></em> Stick to one syntax for groupby. Pick your own if you don’t like mine but stick to one.</p><hr><h2 id=dealing-with-multiple-dataframes-concat-and-merge>Dealing with Multiple Dataframes: Concat and Merge:</h2><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset='/images/pandas_subset/13_hu2944048887995355118.jpeg 500w
, /images/pandas_subset/13_hu6139544100429557980.jpeg 800w
, /images/pandas_subset/13_hu12813146476178287100.jpeg 1200w' src=/images/pandas_subset/13.jpeg alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><h3 id=a-concat>a. concat</h3><p>Sometimes we get data from different sources. Or someone comes to you with multiple files with each file having data for a particular year.</p><p><em><strong>How do we create a single dataframe from a single dataframe?</strong></em></p><p>Here we will create our use case artificially since we just have a single file. We are creating two dataframes first using the basic filter operations we already know.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>movies_2006 = df[df[<span style=color:#ed9d13>&#39;Year&#39;</span>]==<span style=color:#3677a9>2006</span>]
</span></span><span style=display:flex><span>movies_2007 = df[df[<span style=color:#ed9d13>&#39;Year&#39;</span>]==<span style=color:#3677a9>2007</span>]
</span></span></code></pre></div><p>Here we start with two dataframes: <code>movies_2006</code> containing info for movies released in 2006 and <code>movies_2007</code> containing info for movies released in 2007. We want to create a single dataframe that includes movies from both 2006 and 2007</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>movies_06_07 = pd.concat([movies_2006,movies_2007])
</span></span></code></pre></div><h3 id=b-merge>b. merge</h3><p>Most of the data that you will encounter will never come in a single file. One of the files might contain ratings for a particular movie, and another might provide the number of votes for a movie.</p><p>In such a case we have two dataframes which need to be merged so that we can have all the information in a single view.</p><p>Here we will create our use case artificially since we just have a single file. We are creating two dataframes first using the basic column subset operations we already know.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>rating_dataframe = df[[<span style=color:#ed9d13>&#39;Title&#39;</span>,<span style=color:#ed9d13>&#39;Rating&#39;</span>]]
</span></span><span style=display:flex><span>votes_dataframe =  df[[<span style=color:#ed9d13>&#39;Title&#39;</span>,<span style=color:#ed9d13>&#39;Votes&#39;</span>]]
</span></span></code></pre></div><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset='/images/pandas_subset/14_hu13473568275081271033.png 500w
, /images/pandas_subset/14_hu16743110115969159195.png 800w
, /images/pandas_subset/14_hu5329604436425001938.png 1200w
, /images/pandas_subset/14_hu9850696798919489996.png 1500w' src=/images/pandas_subset/14.png alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p>We need to have all this information in a single dataframe. How do we do this?</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>rating_vote_df = pd.merge(rating_dataframe,votes_dataframe,on=<span style=color:#ed9d13>&#39;Title&#39;</span>,how=<span style=color:#ed9d13>&#39;left&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rating_vote_df.head()
</span></span></code></pre></div><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset='/images/pandas_subset/15_hu4116792412344464819.png 500w' src=/images/pandas_subset/15.png alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p>We provide this merge function with four attributes- 1st DF, 2nd DF, join on which column and the joining criteria:<code>['left','right','inner','outer']</code></p><p><em><strong>Recommendation:</strong></em> I usually always end up using left join. You will rarely need to join using outer or right. Actually whenever you need to do a right join you actually just really need a left join with the order of dataframes reversed in the merge function.</p><hr><h2 id=reshaping-dataframes-melt-and-pivot_tablereversemelt>Reshaping Dataframes: Melt and pivot_table(reverseMelt)</h2><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset='/images/pandas_subset/16_hu4399501069447627256.jpeg 500w
, /images/pandas_subset/16_hu5936205561813901141.jpeg 800w
, /images/pandas_subset/16_hu1196482949849131678.jpeg 1200w' src=/images/pandas_subset/16.jpeg alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p>Most of the time, we don’t get data in the exact form we want.</p><p>For example, sometimes we might have data in columns which we might need in rows.</p><p>Let us create an artificial example again. You can look at the code below that I use to create the example, but really it doesn’t matter.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>genre_set = <span style=color:#24909d>set</span>()
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>for</span> genre <span style=color:#6ab825;font-weight:700>in</span> df[<span style=color:#ed9d13>&#39;Genre&#39;</span>].unique():
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>for</span> g <span style=color:#6ab825;font-weight:700>in</span> genre.split(<span style=color:#ed9d13>&#34;,&#34;</span>):
</span></span><span style=display:flex><span>        genre_set.add(g)
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>for</span> genre <span style=color:#6ab825;font-weight:700>in</span> genre_set:
</span></span><span style=display:flex><span>    df[genre] = df[<span style=color:#ed9d13>&#39;Genre&#39;</span>].apply(<span style=color:#6ab825;font-weight:700>lambda</span> x: <span style=color:#3677a9>1</span> <span style=color:#6ab825;font-weight:700>if</span> genre <span style=color:#6ab825;font-weight:700>in</span> x <span style=color:#6ab825;font-weight:700>else</span> <span style=color:#3677a9>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>working_df = df[[<span style=color:#ed9d13>&#39;Title&#39;</span>,<span style=color:#ed9d13>&#39;Rating&#39;</span>, <span style=color:#ed9d13>&#39;Votes&#39;</span>,
</span></span><span style=display:flex><span>       <span style=color:#ed9d13>&#39;Rev_M&#39;</span>]+<span style=color:#24909d>list</span>(genre_set)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>working_df.head()
</span></span></code></pre></div><p>So we start from a <code>working_df</code> like this:</p><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset='/images/pandas_subset/17_hu15856653684065168434.png 500w
, /images/pandas_subset/17_hu3260996683385740444.png 800w
, /images/pandas_subset/17_hu2412085204086466043.png 1200w
, /images/pandas_subset/17_hu16943514941264095644.png 1500w' src=/images/pandas_subset/17.png alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p>Now, this is not particularly a great structure to have data in. We might like it better if we had a dataframe with only one column Genre and we can have multiple rows repeated for the same movie. So the movie ‘Prometheus’ might be having three rows since it has three genres. How do we make that work?</p><p>We use <code>melt</code>:</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>reshaped_df = pd.melt(working_df,id_vars = [<span style=color:#ed9d13>&#39;Title&#39;</span>,<span style=color:#ed9d13>&#39;Rating&#39;</span>,<span style=color:#ed9d13>&#39;Votes&#39;</span>,<span style=color:#ed9d13>&#39;Rev_M&#39;</span>],value_vars = <span style=color:#24909d>list</span>(genre_set),var_name = <span style=color:#ed9d13>&#39;Genre&#39;</span>, value_name =<span style=color:#ed9d13>&#39;Flag&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>reshaped_df.head()
</span></span></code></pre></div><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset='/images/pandas_subset/18_hu5516819245097044934.png 500w
, /images/pandas_subset/18_hu10243495442993755344.png 800w' src=/images/pandas_subset/18.png alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p>So in this melt function, we provided five attributes:</p><ul><li><p>dataframe_name = working_df</p></li><li><p>id_vars: List of vars we want in the current form only.</p></li><li><p>value_vars: List of vars we want to melt/put in the same column</p></li><li><p>var_name: name of the column for value_vars</p></li><li><p>value_name: name of the column for value of value_vars</p></li></ul><p>There is still one thing remaining. For Prometheus, we see that it is a thriller and the flag is 0. The flag 0 is unnecessary data we can filter out, and we will have our results. We keep only the genres with flag 1</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>reshaped_df  = reshaped_df[reshaped_df[<span style=color:#ed9d13>&#39;Flag&#39;</span>]==<span style=color:#3677a9>1</span>]
</span></span></code></pre></div><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset='/images/pandas_subset/19_hu14433445457815096985.png 500w
, /images/pandas_subset/19_hu1199512919390622918.png 800w' src=/images/pandas_subset/19.png alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p><em><strong>What if we want to go back?</strong></em></p><p>We need the values in a column to become multiple columns. How? We use <code>pivot_table</code></p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>re_reshaped_df = reshaped_df.pivot_table(index=[<span style=color:#ed9d13>&#39;Title&#39;</span>,<span style=color:#ed9d13>&#39;Rating&#39;</span>,<span style=color:#ed9d13>&#39;Votes&#39;</span>,<span style=color:#ed9d13>&#39;Rev_M&#39;</span>], columns=<span style=color:#ed9d13>&#39;Genre&#39;</span>,
</span></span><span style=display:flex><span>                        values=<span style=color:#ed9d13>&#39;Flag&#39;</span>, aggfunc=<span style=color:#ed9d13>&#39;sum&#39;</span>).reset_index()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>re_reshaped_df.head()
</span></span></code></pre></div><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset='/images/pandas_subset/20_hu13213243812148294219.png 500w
, /images/pandas_subset/20_hu4722179782540165544.png 800w
, /images/pandas_subset/20_hu12777447052833246982.png 1200w
, /images/pandas_subset/20_hu17089666839710097212.png 1500w' src=/images/pandas_subset/20.png alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p>We provided four attributes to the pivot_table function.</p><ul><li><p>index: We don’t want to change these column structures</p></li><li><p>columns: explode this column into multiple columns</p></li><li><p>values: use this column to aggregate</p></li><li><p>aggfunc: the aggregation function.</p></li></ul><p>We can then fill the missing values by 0 using <code>fillna</code></p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>re_reshaped_df=re_reshaped_df.fillna(<span style=color:#3677a9>0</span>)
</span></span></code></pre></div><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset='/images/pandas_subset/21_hu16162851461356890979.png 500w
, /images/pandas_subset/21_hu3141795837417613230.png 800w
, /images/pandas_subset/21_hu10076247228017044112.png 1200w
, /images/pandas_subset/21_hu2980525767474273227.png 1500w' src=/images/pandas_subset/21.png alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><p><em><strong>Recommendation:</strong></em> Multiple columns to one column: melt and One column to multiple columns: pivot_table . There are other ways to do melt — stack and different ways to do pivot_table: pivot,unstack. Stay away from them and just use melt and pivot_table. There are some valid reasons for this like unstack and stack will create multi-index and we don’t want to deal with that, and pivot cannot take multiple columns as the index.</p><h2 id=conclusion>Conclusion</h2><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset='/images/pandas_subset/22_hu18156305454055573516.jpg 500w
, /images/pandas_subset/22_hu13317098426129020632.jpg 800w' src=/images/pandas_subset/22.jpg alt="MLWhiz: Data Science, Machine Learning, Artificial Intelligence"></p><blockquote><p>With Pandas, less choice is more</p></blockquote><p><em><strong>Here I have tried to profile some of the most useful functions in pandas I end up using most often.</strong></em></p><p>Pandas is a vast library with a lot of functionality and custom options. That makes it essential that you should have a mindmap where you stick to a particular syntax for a specific thing.</p><p><em><strong>Here I have shared mine, and you can proceed with it and make it better as your understanding of the library grows.</strong></em></p><p>I hope you found this post useful and worth your time. I tried to make this as simple as possible, but you may always <strong>ask me</strong> or see the documentation for doubts.</p><p>Whole code and data are posted in the
<a href=https://www.kaggle.com/mlwhiz/minimal-pandas-subset target=_blank rel="nofollow noopener">Kaggle Kernel</a>
.</p><p>Also, if you want to learn more about Python 3, I would like to call out an excellent course on Learn
<a href=https://coursera.pxf.io/0JMOOY target=_blank rel="nofollow noopener">Intermediate level Python</a>
from the University of Michigan. Do check it out.</p><p>I am going to be writing more of such posts in the future too. Let me know what you think about them. Follow me up at
<a href=https://mlwhiz.medium.com/ target=_blank rel="nofollow noopener"><strong>Medium</strong></a>
or Subscribe to my
<a href=https://mlwhiz.ck.page/a9b8bda70c target=_blank rel="nofollow noopener"><strong>blog</strong></a>
.</p><script async data-uid=8d7942551b src=https://mlwhiz.ck.page/8d7942551b/index.js></script><div class=shareaholic-canvas data-app=share_buttons data-app-id=28372088 style=margin-bottom:1px></div><a href=https://coursera.pxf.io/coursera rel=nofollow><img border=0 alt="Start your future with a Data Analysis Certificate." src="https://ad.linksynergy.com/fs-bin/show?id=lVarvwc5BD0&bids=759505.377&subid=0&type=4&gridnum=16"></a><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//mlwhiz.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div class=col-lg-4><div class=widget><script type=text/javascript src=https://ko-fi.com/widgets/widget_2.js></script><script type=text/javascript>kofiwidget2.init("Support Me on Ko-fi","#972EB4","S6S3NPCD"),kofiwidget2.draw()</script></div><div class=widget><h4 class=widget-title>About Me</h4><img src=https://mlwhiz.com/images/author.jpg alt class="img-fluid author-thumb-sm d-block mx-auto rounded-circle mb-4"><p><p>I’m a Machine Learning Engineer based in London, where I am currently working with <strong>Roku</strong> .</p></p><a href=https://mlwhiz.com/about/ class="btn btn-outline-primary">Know More</a></div><div class=widget><h4 class=widget-title>Topics</h4><ul class=list-unstyled><li><a class="categoryStyle text-white" href=/categories/awesome-guides>Awesome Guides</a></li><li><a class="categoryStyle text-white" href=/categories/bash>Bash</a></li><li><a class="categoryStyle text-white" href=/categories/big-data>Big Data</a></li><li><a class="categoryStyle text-white" href=/categories/chatgpt-series>Chatgpt Series</a></li><li><a class="categoryStyle text-white" href=/categories/computer-vision>Computer Vision</a></li><li><a class="categoryStyle text-white" href=/categories/data-science>Data Science</a></li><li><a class="categoryStyle text-white" href=/categories/deep-learning>Deep Learning</a></li><li><a class="categoryStyle text-white" href=/categories/learning-resources>Learning Resources</a></li><li><a class="categoryStyle text-white" href=/categories/machine-learning>Machine Learning</a></li><li><a class="categoryStyle text-white" href=/categories/natural-language-processing>Natural Language Processing</a></li><li><a class="categoryStyle text-white" href=/categories/opinion>Opinion</a></li><li><a class="categoryStyle text-white" href=/categories/programming>Programming</a></li></ul></div><div class=widget><h4 class=widget-title>Tags</h4><ul class=list-inline><li class=list-inline-item><a class="tagStyle text-white" href=/tags/algorithms>Algorithms</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/artificial-intelligence>Artificial Intelligence</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/awesome-guides>Awesome Guides</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/best-content>Best Content</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/big-data>Big Data</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/chatgpt>Chatgpt</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/computer-vision>Computer Vision</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/curated-resources>Curated Resources</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/dask>Dask</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/data-science>Data Science</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/deep-learning>Deep Learning</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/deployment>Deployment</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/ec2>Ec2</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/generative-adversarial-networks>Generative Adversarial Networks</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/graphs>Graphs</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/image-classification>Image Classification</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/instance-segmentation>Instance Segmentation</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/interpretability>Interpretability</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/jobs>Jobs</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/kaggle>Kaggle</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/language-modeling>Language Modeling</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/learning-resources>Learning Resources</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/machine-learning>Machine Learning</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/math>Math</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/multiprocessing>Multiprocessing</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/natural-language-processing>Natural Language Processing</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/object-detection>Object Detection</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/oop>Oop</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/opinion>Opinion</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/pandas>Pandas</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/production>Production</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/productivity>Productivity</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/python>Python</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/pytorch>Pytorch</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/spark>Spark</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/sql>SQL</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/statistics>Statistics</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/streamlit>Streamlit</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/text-classification>Text Classification</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/timeseries>Timeseries</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/tools>Tools</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/transformers>Transformers</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/translation>Translation</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/visualization>Visualization</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/xgboost>Xgboost</a></li></ul></div><div class=widget><h4 class=widget-title>Connect With Me</h4><ul class="list-inline social-links"><li class=list-inline-item><a href="https://linkedin.com/comm/mynetwork/discovery-see-all?usecase=PEOPLE_FOLLOWS&amp;followMember=rahulagwl"><i class=ti-linkedin></i></a></li><li class=list-inline-item><a href=https://mlwhiz.medium.com/><i class=ti-book></i></a></li><li class=list-inline-item><a href=https://twitter.com/MLWhiz><i class=ti-twitter-alt></i></a></li><li class=list-inline-item><a href=https://www.facebook.com/mlwhizblog><i class=ti-facebook></i></a></li><li class=list-inline-item><a href=https://github.com/MLWhiz><i class=ti-github></i></a></li></ul></div><script async data-uid=bfe9f82f10 src=https://mlwhiz.ck.page/bfe9f82f10/index.js></script><script async data-uid=3452d924e2 src=https://mlwhiz.ck.page/3452d924e2/index.js></script></div></div></div></section><footer><div class=container><div class=row><div class="col-12 text-center mb-5"><a href=https://mlwhiz.com/><img src=https://mlwhiz.com/images/logos/mlwhiz_black.png class=img-fluid-custom-bottom alt="MLWhiz - Your Home for DS, ML, AI!"></a></div><div class="col-12 border-top py-4 text-center">Copyright © 2020 <a href=https://mlwhiz.com style=color:#972eb4>MLWhiz</a> All Rights Reserved</div></div></div></footer><script>var indexURL="https://mlwhiz.com/index.json"</script><script src=https://mlwhiz.com/plugins/compressjscss/main.js></script><script src=https://mlwhiz.com/js/script.min.js></script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-54777926-1","auto"),ga("send","pageview")</script></body></html>