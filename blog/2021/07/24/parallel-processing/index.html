<!doctype html><html lang=en-us><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-F34XSWQ5N4"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-F34XSWQ5N4')</script><meta charset=utf-8><title>How Can Data Scientists Use Parallel Processing? - MLWhiz</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="How can data scientists use parallel processing?"><meta name=author content="Rahul Agarwal"><meta name=generator content="Hugo 0.82.0"><link rel=stylesheet href=https://mlwhiz.com/plugins/compressjscss/main.css><meta property="og:title" content="How Can Data Scientists Use Parallel Processing? - MLWhiz"><meta property="og:description" content="How can data scientists use parallel processing?"><meta property="og:type" content="article"><meta property="og:url" content="https://mlwhiz.com/blog/2021/07/24/parallel-processing/"><meta property="og:image" content="https://mlwhiz.com/images/parallel-processing/main.png"><meta property="og:image:secure_url" content="https://mlwhiz.com/images/parallel-processing/main.png"><meta property="article:published_time" content="2021-07-24T00:00:00+00:00"><meta property="article:modified_time" content="2022-11-27T14:15:35+00:00"><meta property="article:tag" content="Deep Learning"><meta property="article:tag" content="Natural Language Processing"><meta property="article:tag" content="Awesome Guides"><meta name=twitter:card content="summary"><meta name=twitter:image content="https://mlwhiz.com/images/parallel-processing/main.png"><meta name=twitter:title content="How Can Data Scientists Use Parallel Processing? - MLWhiz"><meta name=twitter:description content="How can data scientists use parallel processing?"><meta name=twitter:site content="@mlwhiz"><meta name=twitter:creator content="@mlwhiz"><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href=https://mlwhiz.com/scss/style.min.css media=screen><link rel=stylesheet href=/css/style.css><link rel=stylesheet type=text/css href=/css/font/flaticon.css><link rel="shortcut icon" href=https://mlwhiz.com/images/logos/favicon-32x32.png type=image/x-icon><link rel=icon href=https://mlwhiz.com/images/logos/favicon.ico type=image/x-icon><link rel=canonical href=https://mlwhiz.com/blog/2021/07/24/parallel-processing/><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://www.mlwhiz.com/#website","url":"https://www.mlwhiz.com/","name":"MLWhiz","description":"Want to Learn Computer Vision and NLP? - MLWhiz","potentialAction":{"@type":"SearchAction","target":"https://www.mlwhiz.com/search?s={search_term_string}","query-input":"required name=search_term_string"}},{"@type":"ImageObject","@id":"https://mlwhiz.com/blog/2021/07/24/parallel-processing/#primaryimage","url":"https://mlwhiz.com/images/parallel-processing/main.png","width":700,"height":450},{"@type":"WebPage","@id":"https://mlwhiz.com/blog/2021/07/24/parallel-processing/#webpage","url":"https://mlwhiz.com/blog/2021/07/24/parallel-processing/","inLanguage":"en-US","name":"How Can Data Scientists Use Parallel Processing? - MLWhiz","isPartOf":{"@id":"https://www.mlwhiz.com/#website"},"primaryImageOfPage":{"@id":"https://mlwhiz.com/blog/2021/07/24/parallel-processing/#primaryimage"},"datePublished":"2021-07-24T00:00:00.00Z","dateModified":"2022-11-27T14:15:35.00Z","author":{"@id":"https://mlwhiz.com/about/#/schema/person/76376876bchxkzbchjsdjcca"},"description":"How can data scientists use parallel processing?"},{"@type":["Person"],"@id":"https://mlwhiz.com/about/#/schema/person/76376876bchxkzbchjsdjcca","name":"Rahul Agarwal","image":{"@type":"ImageObject","@id":"https://www.mlwhiz.com/#authorlogo","url":"https://mlwhiz.com/images/author.jpg","caption":"Rahul Agarwal"},"description":"Hi there, I\u2019m Rahul Agarwal. I\u2019m a data scientist consultant and big data engineer based in Bangalore. I see a lot of times  students and even professionals wasting their time and struggling to get started with Computer Vision, Deep Learning, and NLP. I Started this Site with a purpose to augment my own understanding about new things while helping others learn about them in the best possible way.","sameAs":["https://www.linkedin.com/in/rahulagwl/","https://medium.com/@rahul_agarwal","https://twitter.com/MLWhiz","https://www.facebook.com/mlwhizblog","https://github.com/MLWhiz","https://www.instagram.com/itsmlwhiz"]}]}</script><script async data-uid=a0ebaf958d src=https://mlwhiz.ck.page/a0ebaf958d/index.js></script><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$']],processEscapes:!0,processEnvironments:!0,skipTags:['script','noscript','style','textarea','pre'],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var b=MathJax.Hub.getAllJax(),a;for(a=0;a<b.length;a+=1)b[a].SourceElement().parentNode.className+=' has-jax'}),MathJax.Hub.Config({TeX:{equationNumbers:{autoNumber:"AMS"}}})</script><link href=//apps.shareaholic.com/assets/pub/shareaholic.js as=script><script type=text/javascript data-cfasync=false async src=//apps.shareaholic.com/assets/pub/shareaholic.js data-shr-siteid=fd1ffa7fd7152e4e20568fbe49a489d0></script><script>!function(b,e,f,g,a,c,d){if(b.fbq)return;a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version='2.0',a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js'),fbq('init','402633927768628'),fbq('track','PageView')</script><noscript><img height=1 width=1 style=display:none src="https://www.facebook.com/tr?id=402633927768628&ev=PageView&noscript=1"></noscript><meta property="fb:pages" content="213104036293742"><meta name=facebook-domain-verification content="qciidcy7mm137sewruizlvh8zbfnv4"><meta name=impact-site-verification value=1670148355></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NMQD44T" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><div class=preloader></div><header class=navigation><div class=container><nav class="navbar navbar-expand-lg navbar-white bg-transparent border-bottom pl-0"><a class="navbar-brand mobile-view" href=https://mlwhiz.com/><img class=img-fluid src=https://mlwhiz.com/images/logos/logo.svg alt="MLWhiz - Your Home for DS, ML, AI!"></a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class="ti-menu h3"></i></button><div class="collapse navbar-collapse text-center" id=navigation><div class=desktop-view><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href="https://linkedin.com/comm/mynetwork/discovery-see-all?usecase=PEOPLE_FOLLOWS&followMember=rahulagwl"><i class=ti-linkedin></i></a></li><li class=nav-item><a class=nav-link href=https://mlwhiz.medium.com/><i class=ti-book></i></a></li><li class=nav-item><a class=nav-link href=https://twitter.com/MLWhiz><i class=ti-twitter-alt></i></a></li><li class=nav-item><a class=nav-link href=https://www.facebook.com/mlwhizblog><i class=ti-facebook></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/MLWhiz><i class=ti-github></i></a></li></ul></div><a class="navbar-brand mx-auto desktop-view" href=https://mlwhiz.com/><img class=img-fluid-custom src=https://mlwhiz.com/images/logos/logo.svg alt="MLWhiz - Your Home for DS, ML, AI!"></a><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://mlwhiz.com/about>About</a></li><li class=nav-item><a class=nav-link href=https://mlwhiz.com/blog>Blog</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Topics</a><div class=dropdown-menu><a class=dropdown-item href=https://mlwhiz.com/categories/natural-language-processing>NLP</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/computer-vision>Computer Vision</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/deep-learning>Deep Learning</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/data-science>DS/ML</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/big-data>Big Data</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/awesome-guides>My Best Content</a>
<a class=dropdown-item href=https://mlwhiz.com/categories/learning-resources>Learning Resources</a></div></li></ul><div class="search pl-lg-4"><button id=searchOpen class=search-btn><i class=ti-search></i></button><div class=search-wrapper><form action=https://mlwhiz.com//search class=h-100><input class="search-box px-4" id=search-query name=s type=search placeholder="Type & Hit Enter..."></form><button id=searchClose class=search-close><i class="ti-close text-dark"></i></button></div></div></div></nav></div></header><section class=section-sm><div class=container><div class=row><div class="col-lg-8 mb-5 mb-lg-0"><a href=/categories/deep-learning class=categoryStyle>Deep Learning</a>
<a href=/categories/natural-language-processing class=categoryStyle>Natural Language Processing</a>
<a href=/categories/awesome-guides class=categoryStyle>Awesome Guides</a><h1>How Can Data Scientists Use Parallel Processing?</h1><div class="mb-3 post-meta"><span>By Rahul Agarwal</span><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg>
<span>24 July 2021</span></div><img src=https://mlwhiz.com/images/parallel-processing/main.png class="img-fluid w-100 mb-4" alt="How Can Data Scientists Use Parallel Processing?"><div class="content mb-5"><p>Finally, my program is running! Should I go and get a coffee?</p><p>We data scientists have got powerful laptops. Laptops which have quad-core or octa-core processors and Turbo Boost technology. We routinely work with servers with even more cores and computing power. But do we really use the raw power we have at hand?</p><p>Instead of taking advantage of our resources, too often we sit around and wait for time-consuming processes to finish. Sometimes we wait for hours, even when urgent deliverables are approaching the deadline. Can we somehow do better?</p><p><em><strong>In this post, I will explain how to use multiprocessing and Joblib to make your code parallel and get out some extra work out of that big machine of yours.</strong></em></p><hr><h2 id=1-using-mutiprocessing-with-single-parameter-function>1. Using Mutiprocessing with Single parameter function:</h2><p>To motivate multiprocessing, I will start with a problem where we have a big list and we want to apply a function to every element in the list.</p><p>Why do we want to do this? This might feel like a trivial problem but this is particularly what we do on a daily basis in Data Science. For Example: We have a model and we run multiple iterations of the model with different hyperparameters. Or, we are creating a new feature in a big dataframe and we apply a function row by row to a dataframe using the apply keyword. By the end of this post, you would be able to parallelize most of the use cases you face in data science with this simple construct.</p><p>So, coming back to our toy problem, let’s say we want to apply the square function to all our elements in the list.</p><pre><code>def square(num):
    return x**2
</code></pre><p>Of course we can use simple python to run the above function on all elements of the list.</p><pre><code>result = [f(x) for x in list(range(100000))]
</code></pre><p>But, the above code is running sequentially. Here is how we can use multiprocessing to apply this function to all the elements of a given list list(range(100000)) in parallel using the 8 cores in our powerful computer.</p><pre><code>from multiprocessing import Pool
pool = Pool(8)
result = pool.map(f,list(range(100000)))
pool.close()
</code></pre><p>The lines above create a multiprocessing pool of 8 workers and we can use this pool of 8 workers to map our required function to this list.</p><p>Lets check how this code performs:</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=color:#6ab825;font-weight:700>from</span> <span style=color:#447fcf;text-decoration:underline>multiprocessing</span> <span style=color:#6ab825;font-weight:700>import</span> Pool
<span style=color:#6ab825;font-weight:700>import</span> <span style=color:#447fcf;text-decoration:underline>time</span>
<span style=color:#6ab825;font-weight:700>import</span> <span style=color:#447fcf;text-decoration:underline>plotly.express</span> <span style=color:#6ab825;font-weight:700>as</span> <span style=color:#447fcf;text-decoration:underline>px</span>
<span style=color:#6ab825;font-weight:700>import</span> <span style=color:#447fcf;text-decoration:underline>plotly</span>
<span style=color:#6ab825;font-weight:700>import</span> <span style=color:#447fcf;text-decoration:underline>pandas</span> <span style=color:#6ab825;font-weight:700>as</span> <span style=color:#447fcf;text-decoration:underline>pd</span>

<span style=color:#6ab825;font-weight:700>def</span> <span style=color:#447fcf>f</span>(x):
    <span style=color:#6ab825;font-weight:700>return</span> x**<span style=color:#3677a9>2</span>

<span style=color:#6ab825;font-weight:700>def</span> <span style=color:#447fcf>runner</span>(list_length):
    <span style=color:#6ab825;font-weight:700>print</span>(f<span style=color:#ed9d13>&#34;Size of List:{list_length}&#34;</span>)
    t0 = time.time()
    result1 = [f(x) <span style=color:#6ab825;font-weight:700>for</span> x <span style=color:#6ab825;font-weight:700>in</span> <span style=color:#24909d>list</span>(<span style=color:#24909d>range</span>(list_length))]
    t1 = time.time()
    <span style=color:#6ab825;font-weight:700>print</span>(f<span style=color:#ed9d13>&#34;Without multiprocessing we ran the function in {t1 - t0:0.4f} seconds&#34;</span>)
    time_without_multiprocessing = t1-t0
    t0 = time.time()
    pool = Pool(<span style=color:#3677a9>8</span>)
    result2 = pool.map(f,<span style=color:#24909d>list</span>(<span style=color:#24909d>range</span>(list_length)))
    pool.close()
    t1 = time.time()
    <span style=color:#6ab825;font-weight:700>print</span>(f<span style=color:#ed9d13>&#34;With multiprocessing we ran the function in {t1 - t0:0.4f} seconds&#34;</span>)
    time_with_multiprocessing = t1-t0
    <span style=color:#6ab825;font-weight:700>return</span> time_without_multiprocessing, time_with_multiprocessing

<span style=color:#6ab825;font-weight:700>if</span> __name__ ==  <span style=color:#ed9d13>&#39;__main__&#39;</span>:
    times_taken = []
    <span style=color:#6ab825;font-weight:700>for</span> i <span style=color:#6ab825;font-weight:700>in</span> <span style=color:#24909d>range</span>(<span style=color:#3677a9>1</span>,<span style=color:#3677a9>9</span>):
        list_length = <span style=color:#3677a9>10</span>**i
        time_without_multiprocessing, time_with_multiprocessing = runner(list_length)
        times_taken.append([list_length, <span style=color:#ed9d13>&#39;No Mutiproc&#39;</span>, time_without_multiprocessing])
        times_taken.append([list_length, <span style=color:#ed9d13>&#39;Multiproc&#39;</span>, time_with_multiprocessing])

    timedf = pd.DataFrame(times_taken,columns = [<span style=color:#ed9d13>&#39;list_length&#39;</span>, <span style=color:#ed9d13>&#39;type&#39;</span>,<span style=color:#ed9d13>&#39;time_taken&#39;</span>])
    fig =  px.line(timedf,x = <span style=color:#ed9d13>&#39;list_length&#39;</span>,y=<span style=color:#ed9d13>&#39;time_taken&#39;</span>,color=<span style=color:#ed9d13>&#39;type&#39;</span>,log_x=True)
    plotly.offline.plot(fig, filename=<span style=color:#ed9d13>&#39;comparison_bw_multiproc.html&#39;</span>)

</code></pre></div><pre><code>Size of List:10
Without multiprocessing we ran the function in 0.0000 seconds
With multiprocessing we ran the function in 0.5960 seconds
Size of List:100
Without multiprocessing we ran the function in 0.0001 seconds
With multiprocessing we ran the function in 0.6028 seconds
Size of List:1000
Without multiprocessing we ran the function in 0.0006 seconds
With multiprocessing we ran the function in 0.6052 seconds
Size of List:10000
Without multiprocessing we ran the function in 0.0046 seconds
With multiprocessing we ran the function in 0.5956 seconds
Size of List:100000
Without multiprocessing we ran the function in 0.0389 seconds
With multiprocessing we ran the function in 0.6486 seconds
Size of List:1000000
Without multiprocessing we ran the function in 0.3654 seconds
With multiprocessing we ran the function in 0.7684 seconds
Size of List:10000000
Without multiprocessing we ran the function in 3.6297 seconds
With multiprocessing we ran the function in 1.8084 seconds
Size of List:100000000
Without multiprocessing we ran the function in 36.0620 seconds
With multiprocessing we ran the function in 16.9765 seconds
</code></pre><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset="/images/parallel-processing/0_huc3f24ed469087bf974442d594dacc2a8_39723_500x0_resize_box_2.png 500w
, /images/parallel-processing/0_huc3f24ed469087bf974442d594dacc2a8_39723_800x0_resize_box_2.png 800w
, /images/parallel-processing/0_huc3f24ed469087bf974442d594dacc2a8_39723_1200x0_resize_box_2.png 1200w
, /images/parallel-processing/0_huc3f24ed469087bf974442d594dacc2a8_39723_1500x0_resize_box_2.png 1500w" src=/images/parallel-processing/0.png alt="Image by Author"></p><p>As we can see the runtime of multiprocess was somewhat more till some list length but doesn’t increase as fast as the non-multiprocessing function runtime increases for larger list lengths. This tells us that there is a certain overhead of using multiprocessing and it doesn’t make too much sense for computations that take a small time.</p><p>In practice, we won’t be using multiprocessing for functions that get over in milliseconds but for much larger computations that could take more than a few seconds and sometimes hours. So lets try a more involved computation which would take more than 2 seconds. I am using time.sleep as a proxy for computation here.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py>
<span style=color:#6ab825;font-weight:700>from</span> <span style=color:#447fcf;text-decoration:underline>multiprocessing</span> <span style=color:#6ab825;font-weight:700>import</span> Pool
<span style=color:#6ab825;font-weight:700>import</span> <span style=color:#447fcf;text-decoration:underline>time</span>
<span style=color:#6ab825;font-weight:700>import</span> <span style=color:#447fcf;text-decoration:underline>plotly.express</span> <span style=color:#6ab825;font-weight:700>as</span> <span style=color:#447fcf;text-decoration:underline>px</span>
<span style=color:#6ab825;font-weight:700>import</span> <span style=color:#447fcf;text-decoration:underline>plotly</span>
<span style=color:#6ab825;font-weight:700>import</span> <span style=color:#447fcf;text-decoration:underline>pandas</span> <span style=color:#6ab825;font-weight:700>as</span> <span style=color:#447fcf;text-decoration:underline>pd</span>

<span style=color:#6ab825;font-weight:700>def</span> <span style=color:#447fcf>f</span>(x):
    time.sleep(<span style=color:#3677a9>2</span>)
    <span style=color:#6ab825;font-weight:700>return</span> x**<span style=color:#3677a9>2</span>


<span style=color:#6ab825;font-weight:700>def</span> <span style=color:#447fcf>runner</span>(list_length):
    <span style=color:#6ab825;font-weight:700>print</span>(f<span style=color:#ed9d13>&#34;Size of List:{list_length}&#34;</span>)
    t0 = time.time()
    result1 = [f(x) <span style=color:#6ab825;font-weight:700>for</span> x <span style=color:#6ab825;font-weight:700>in</span> <span style=color:#24909d>list</span>(<span style=color:#24909d>range</span>(list_length))]
    t1 = time.time()
    <span style=color:#6ab825;font-weight:700>print</span>(f<span style=color:#ed9d13>&#34;Without multiprocessing we ran the function in {t1 - t0:0.4f} seconds&#34;</span>)
    time_without_multiprocessing = t1-t0
    t0 = time.time()
    pool = Pool(<span style=color:#3677a9>8</span>)
    result2 = pool.map(f,<span style=color:#24909d>list</span>(<span style=color:#24909d>range</span>(list_length)))
    pool.close()
    t1 = time.time()
    <span style=color:#6ab825;font-weight:700>print</span>(f<span style=color:#ed9d13>&#34;With multiprocessing we ran the function in {t1 - t0:0.4f} seconds&#34;</span>)
    time_with_multiprocessing = t1-t0
    <span style=color:#6ab825;font-weight:700>return</span> time_without_multiprocessing, time_with_multiprocessing

<span style=color:#6ab825;font-weight:700>if</span> __name__ ==  <span style=color:#ed9d13>&#39;__main__&#39;</span>:
    times_taken = []
    <span style=color:#6ab825;font-weight:700>for</span> i <span style=color:#6ab825;font-weight:700>in</span> <span style=color:#24909d>range</span>(<span style=color:#3677a9>1</span>,<span style=color:#3677a9>10</span>):
        list_length = i
        time_without_multiprocessing, time_with_multiprocessing = runner(list_length)
        times_taken.append([list_length, <span style=color:#ed9d13>&#39;No Mutiproc&#39;</span>, time_without_multiprocessing])
        times_taken.append([list_length, <span style=color:#ed9d13>&#39;Multiproc&#39;</span>, time_with_multiprocessing])

    timedf = pd.DataFrame(times_taken,columns = [<span style=color:#ed9d13>&#39;list_length&#39;</span>, <span style=color:#ed9d13>&#39;type&#39;</span>,<span style=color:#ed9d13>&#39;time_taken&#39;</span>])
    fig =  px.line(timedf,x = <span style=color:#ed9d13>&#39;list_length&#39;</span>,y=<span style=color:#ed9d13>&#39;time_taken&#39;</span>,color=<span style=color:#ed9d13>&#39;type&#39;</span>)
    plotly.offline.plot(fig, filename=<span style=color:#ed9d13>&#39;comparison_bw_multiproc.html&#39;</span>)

</code></pre></div><pre><code>Size of List:1
Without multiprocessing we ran the function in 2.0012 seconds
With multiprocessing we ran the function in 2.7370 seconds
Size of List:2
Without multiprocessing we ran the function in 4.0039 seconds
With multiprocessing we ran the function in 2.6518 seconds
Size of List:3
Without multiprocessing we ran the function in 6.0074 seconds
With multiprocessing we ran the function in 2.6580 seconds
Size of List:4
Without multiprocessing we ran the function in 8.0127 seconds
With multiprocessing we ran the function in 2.6421 seconds
Size of List:5
Without multiprocessing we ran the function in 10.0173 seconds
With multiprocessing we ran the function in 2.7109 seconds
Size of List:6
Without multiprocessing we ran the function in 12.0039 seconds
With multiprocessing we ran the function in 2.6438 seconds
Size of List:7
Without multiprocessing we ran the function in 14.0240 seconds
With multiprocessing we ran the function in 2.6375 seconds
Size of List:8
Without multiprocessing we ran the function in 16.0216 seconds
With multiprocessing we ran the function in 2.6376 seconds
Size of List:9
Without multiprocessing we ran the function in 18.0183 seconds
With multiprocessing we ran the function in 4.6141 seconds
</code></pre><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset="/images/parallel-processing/1_huecdae37e75ba0830044c4ed9dfa9076e_40465_500x0_resize_box_2.png 500w
, /images/parallel-processing/1_huecdae37e75ba0830044c4ed9dfa9076e_40465_800x0_resize_box_2.png 800w
, /images/parallel-processing/1_huecdae37e75ba0830044c4ed9dfa9076e_40465_1200x0_resize_box_2.png 1200w
, /images/parallel-processing/1_huecdae37e75ba0830044c4ed9dfa9076e_40465_1500x0_resize_box_2.png 1500w" src=/images/parallel-processing/1.png alt="Image by Author"></p><p>As you can see, the difference is much more stark in this case and the function without multiprocess takes much more time in this case compared to when we use multiprocess. Again this makes perfect sense as when we start multiprocess 8 workers start working in parallel on the tasks while when we don’t use multiprocessing the tasks happen in a sequential manner with each task taking 2 seconds.</p><hr><h2 id=2-multiprocessing-with-function-with-multiple-params-function>2. Multiprocessing with function with Multiple Params function:</h2><p>An extension to the above code is the case when we have to run a function that could take multiple parameters. For a use case, let’s say you have to tune a particular model using multiple hyperparameters. You can do something like:</p><pre><code>import random
def model_runner(n_estimators, max_depth):
    # Some code that runs and fits our model here using the   
    # hyperparams in the argument.
    # Proxy for this code with sleep.
    time.sleep(random.choice([1,2,3])
    # Return some model evaluation score
    return random.choice([1,2,3])
</code></pre><p>How would you run such a function. You can do this in two ways.</p><p><strong>a) Using Pool.map and * magic</strong></p><pre><code>def multi_run_wrapper(args):
   return model_runner(*args)

pool = Pool(4)
hyperparams = [[100,4],[150,5],[200,6],[300,4]]

results = pool.map(multi_run_wrapper,hyperparams)
pool.close()
</code></pre><p>In the above code, we provide args to the model_runner using</p><p><strong>b) Using pool.starmap</strong></p><p>From Python3.3 onwards we can use starmap method to achieve what we have done above even more easily.</p><pre><code>pool = Pool(4)
hyperparams = [[100,4],[150,5],[200,6],[300,4]]

results = pool.starmap(model_runner,hyperparams)
pool.close()
</code></pre><hr><h2 id=3-using-joblib-with-single-parameter-function>3. Using Joblib with Single parameter function:</h2><p>Joblib is another library that provides a simple helper class to write embarassingly parallel for loops using multiprocessing and I find it pretty much easier to use than the multiprocessing module. Running a parallel process is as simple as writing a single line with the Parallel and delayed keywords:</p><pre><code>from joblib import Parallel, delayed
import time

def f(x):
    time.sleep(2)
    return x**2

results = Parallel(n_jobs=8)(delayed(f)(i) for i in range(10))
</code></pre><p>Let’s try to compare Joblib parallel to multiprocessing module using the same function we used before.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=color:#6ab825;font-weight:700>from</span> <span style=color:#447fcf;text-decoration:underline>multiprocessing</span> <span style=color:#6ab825;font-weight:700>import</span> Pool
<span style=color:#6ab825;font-weight:700>import</span> <span style=color:#447fcf;text-decoration:underline>time</span>
<span style=color:#6ab825;font-weight:700>import</span> <span style=color:#447fcf;text-decoration:underline>plotly.express</span> <span style=color:#6ab825;font-weight:700>as</span> <span style=color:#447fcf;text-decoration:underline>px</span>
<span style=color:#6ab825;font-weight:700>import</span> <span style=color:#447fcf;text-decoration:underline>plotly</span>
<span style=color:#6ab825;font-weight:700>import</span> <span style=color:#447fcf;text-decoration:underline>pandas</span> <span style=color:#6ab825;font-weight:700>as</span> <span style=color:#447fcf;text-decoration:underline>pd</span>
<span style=color:#6ab825;font-weight:700>from</span> <span style=color:#447fcf;text-decoration:underline>joblib</span> <span style=color:#6ab825;font-weight:700>import</span> Parallel, delayed

<span style=color:#6ab825;font-weight:700>def</span> <span style=color:#447fcf>f</span>(x):
    time.sleep(<span style=color:#3677a9>2</span>)
    <span style=color:#6ab825;font-weight:700>return</span> x**<span style=color:#3677a9>2</span>


<span style=color:#6ab825;font-weight:700>def</span> <span style=color:#447fcf>runner</span>(list_length):
    <span style=color:#6ab825;font-weight:700>print</span>(f<span style=color:#ed9d13>&#34;Size of List:{list_length}&#34;</span>)
    t0 = time.time()
    result1 = Parallel(n_jobs=<span style=color:#3677a9>8</span>)(delayed(f)(i) <span style=color:#6ab825;font-weight:700>for</span> i <span style=color:#6ab825;font-weight:700>in</span> <span style=color:#24909d>range</span>(list_length))
    t1 = time.time()
    <span style=color:#6ab825;font-weight:700>print</span>(f<span style=color:#ed9d13>&#34;With joblib we ran the function in {t1 - t0:0.4f} seconds&#34;</span>)
    time_without_multiprocessing = t1-t0
    t0 = time.time()
    pool = Pool(<span style=color:#3677a9>8</span>)
    result2 = pool.map(f,<span style=color:#24909d>list</span>(<span style=color:#24909d>range</span>(list_length)))
    pool.close()
    t1 = time.time()
    <span style=color:#6ab825;font-weight:700>print</span>(f<span style=color:#ed9d13>&#34;With multiprocessing we ran the function in {t1 - t0:0.4f} seconds&#34;</span>)
    time_with_multiprocessing = t1-t0
    <span style=color:#6ab825;font-weight:700>return</span> time_without_multiprocessing, time_with_multiprocessing

<span style=color:#6ab825;font-weight:700>if</span> __name__ ==  <span style=color:#ed9d13>&#39;__main__&#39;</span>:
    times_taken = []
    <span style=color:#6ab825;font-weight:700>for</span> i <span style=color:#6ab825;font-weight:700>in</span> <span style=color:#24909d>range</span>(<span style=color:#3677a9>1</span>,<span style=color:#3677a9>16</span>):
        list_length = i
        time_without_multiprocessing, time_with_multiprocessing = runner(list_length)
        times_taken.append([list_length, <span style=color:#ed9d13>&#39;No Mutiproc&#39;</span>, time_without_multiprocessing])
        times_taken.append([list_length, <span style=color:#ed9d13>&#39;Multiproc&#39;</span>, time_with_multiprocessing])

    timedf = pd.DataFrame(times_taken,columns = [<span style=color:#ed9d13>&#39;list_length&#39;</span>, <span style=color:#ed9d13>&#39;type&#39;</span>,<span style=color:#ed9d13>&#39;time_taken&#39;</span>])
    fig =  px.line(timedf,x = <span style=color:#ed9d13>&#39;list_length&#39;</span>,y=<span style=color:#ed9d13>&#39;time_taken&#39;</span>,color=<span style=color:#ed9d13>&#39;type&#39;</span>)
    plotly.offline.plot(fig, filename=<span style=color:#ed9d13>&#39;comparison_bw_multiproc.html&#39;</span>)

</code></pre></div><p><img sizes="(min-width: 35em) 1200px, 100vw" srcset="/images/parallel-processing/2_hu805c71cd88e7fd5bf607736d00105ba5_42684_500x0_resize_box_2.png 500w
, /images/parallel-processing/2_hu805c71cd88e7fd5bf607736d00105ba5_42684_800x0_resize_box_2.png 800w
, /images/parallel-processing/2_hu805c71cd88e7fd5bf607736d00105ba5_42684_1200x0_resize_box_2.png 1200w
, /images/parallel-processing/2_hu805c71cd88e7fd5bf607736d00105ba5_42684_1500x0_resize_box_2.png 1500w" src=/images/parallel-processing/2.png alt="Image by Author">
<em>Image by Author</em></p><p>We can see that the runtimes are pretty much comparable and the joblib code looks much more succint than that of multiprocessing.</p><hr><h2 id=4-using-joblib-with-multiple-params-function>4. Using Joblib with Multiple Params function:</h2><p>Using multiple arguments for a function is as simple as just passing the arguments using Joblib. Here is a minimal example you can use.</p><pre><code>from joblib import Parallel, delayed
import time

def f(x,y):
    time.sleep(2)
    return x**2 + y**2

params = [[x,x] for x in range(10)]
results = Parallel(n_jobs=8)(delayed(f)(x,y) for x,y in params)
</code></pre><hr><h2 id=conclusion>Conclusion</h2><p>Multiprocessing is a nice concept and something every data scientist should at least know about it. It won’t solve all your problems, and you should still work on optimizing your functions. But having it would save a lot of time you would spend just waiting for your code to finish.</p><h3 id=continue-learning>Continue Learning</h3><p>If you want to learn more about
<a href=https://amzn.to/2XPSiiG target=_blank rel="nofollow noopener">Python</a>
3, I would like to call out an excellent course on Learn
<a href=https://coursera.pxf.io/0JMOOY target=_blank rel="nofollow noopener">Intermediate level Python</a>
from the University of Michigan. Do check it out.</p><p>I am going to be writing more beginner-friendly posts in the future too. Follow me up at
<a href=http://mlwhiz.medium.com target=_blank rel="nofollow noopener">Medium</a>
or Subscribe to my
<a href=mlwhiz.com>blog</a>
to be informed about them. As always, I welcome feedback and constructive criticism and can be reached on Twitter
<a href=https://twitter.com/MLWhiz target=_blank rel="nofollow noopener">@mlwhiz</a>
.</p><p>Also, a small disclaimer — There might be some affiliate links in this post to relevant resources, as sharing knowledge is never a bad idea.</p><script async data-uid=8d7942551b src=https://mlwhiz.ck.page/8d7942551b/index.js></script><div class=shareaholic-canvas data-app=share_buttons data-app-id=28372088 style=margin-bottom:1px></div><a href=https://coursera.pxf.io/coursera rel=nofollow><img border=0 alt="Start your future with a Data Analysis Certificate." src="https://ad.linksynergy.com/fs-bin/show?id=lVarvwc5BD0&bids=759505.377&subid=0&type=4&gridnum=16"></a><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//mlwhiz.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div class=col-lg-4><div class=widget><script type=text/javascript src=https://ko-fi.com/widgets/widget_2.js></script><script type=text/javascript>kofiwidget2.init('Support Me on Ko-fi','#972EB4','S6S3NPCD'),kofiwidget2.draw()</script></div><div class=widget><h4 class=widget-title>About Me</h4><img src=https://mlwhiz.com/images/author.jpg alt class="img-fluid author-thumb-sm d-block mx-auto rounded-circle mb-4"><p>I’m a Machine Learning Engineer based in London, where I am currently working with Roku .</p><a href=https://mlwhiz.com/about/ class="btn btn-outline-primary">Know More</a></div><div class=widget><h4 class=widget-title>Topics</h4><ul class=list-unstyled><li><a class="categoryStyle text-white" href=/categories/awesome-guides>Awesome Guides</a></li><li><a class="categoryStyle text-white" href=/categories/bash>Bash</a></li><li><a class="categoryStyle text-white" href=/categories/big-data>Big Data</a></li><li><a class="categoryStyle text-white" href=/categories/chatgpt-series>Chatgpt Series</a></li><li><a class="categoryStyle text-white" href=/categories/computer-vision>Computer Vision</a></li><li><a class="categoryStyle text-white" href=/categories/data-science>Data Science</a></li><li><a class="categoryStyle text-white" href=/categories/deep-learning>Deep Learning</a></li><li><a class="categoryStyle text-white" href=/categories/learning-resources>Learning Resources</a></li><li><a class="categoryStyle text-white" href=/categories/machine-learning>Machine Learning</a></li><li><a class="categoryStyle text-white" href=/categories/natural-language-processing>Natural Language Processing</a></li><li><a class="categoryStyle text-white" href=/categories/opinion>Opinion</a></li><li><a class="categoryStyle text-white" href=/categories/programming>Programming</a></li></ul></div><div class=widget><h4 class=widget-title>Tags</h4><ul class=list-inline><li class=list-inline-item><a class="tagStyle text-white" href=/tags/algorithms>Algorithms</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/artificial-intelligence>Artificial Intelligence</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/chatgpt>Chatgpt</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/dask>Dask</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/deployment>Deployment</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/ec2>Ec2</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/generative-adversarial-networks>Generative Adversarial Networks</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/graphs>Graphs</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/image-classification>Image Classification</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/instance-segmentation>Instance Segmentation</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/interpretability>Interpretability</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/jobs>Jobs</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/kaggle>Kaggle</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/language-modeling>Language Modeling</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/machine-learning>Machine Learning</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/math>Math</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/multiprocessing>Multiprocessing</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/object-detection>Object Detection</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/oop>Oop</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/opinion>Opinion</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/pandas>Pandas</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/production>Production</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/productivity>Productivity</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/python>Python</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/pytorch>Pytorch</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/spark>Spark</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/sql>SQL</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/statistics>Statistics</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/streamlit>Streamlit</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/text-classification>Text Classification</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/timeseries>Timeseries</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/tools>Tools</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/transformers>Transformers</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/translation>Translation</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/visualization>Visualization</a></li><li class=list-inline-item><a class="tagStyle text-white" href=/tags/xgboost>Xgboost</a></li></ul></div><div class=widget><h4 class=widget-title>Connect With Me</h4><ul class="list-inline social-links"><li class=list-inline-item><a href="https://linkedin.com/comm/mynetwork/discovery-see-all?usecase=PEOPLE_FOLLOWS&followMember=rahulagwl"><i class=ti-linkedin></i></a></li><li class=list-inline-item><a href=https://mlwhiz.medium.com/><i class=ti-book></i></a></li><li class=list-inline-item><a href=https://twitter.com/MLWhiz><i class=ti-twitter-alt></i></a></li><li class=list-inline-item><a href=https://www.facebook.com/mlwhizblog><i class=ti-facebook></i></a></li><li class=list-inline-item><a href=https://github.com/MLWhiz><i class=ti-github></i></a></li></ul></div><script async data-uid=bfe9f82f10 src=https://mlwhiz.ck.page/bfe9f82f10/index.js></script><script async data-uid=3452d924e2 src=https://mlwhiz.ck.page/3452d924e2/index.js></script></div></div></div></section><footer><div class=container><div class=row><div class="col-12 text-center mb-5"><a href=https://mlwhiz.com/><img src=https://mlwhiz.com/images/logos/mlwhiz_black.png class=img-fluid-custom-bottom alt="MLWhiz - Your Home for DS, ML, AI!"></a></div><div class="col-12 border-top py-4 text-center">Copyright © 2020 <a href=https://mlwhiz.com style=color:#972eb4>MLWhiz</a> All Rights Reserved</div></div></div></footer><script>var indexURL="https://mlwhiz.com/index.json"</script><script src=https://mlwhiz.com/plugins/compressjscss/main.js></script><script src=https://mlwhiz.com/js/script.min.js></script><script>(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'),ga('create','UA-54777926-1','auto'),ga('send','pageview')</script></body></html>